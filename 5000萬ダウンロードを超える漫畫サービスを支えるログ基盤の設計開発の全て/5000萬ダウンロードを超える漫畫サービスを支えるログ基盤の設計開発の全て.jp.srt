1
00:00:11,018 --> 00:00:12,878
本日はですね

2
00:00:12,878 --> 00:00:16,658
5000万ダウンロードを超える漫画サービス

3
00:00:16,658 --> 00:00:22,158
もとい電子コミックサービスを支えるログ基盤の設計開発のすべて

4
00:00:22,158 --> 00:00:23,500
それを題してですね

5
00:00:23,500 --> 00:00:25,839
話していこうと思います

6
00:00:25,839 --> 00:00:29,617
ちょっとした自己紹介なんですけど

7
00:00:29,617 --> 00:00:31,539
デスクスと申します

8
00:00:31,539 --> 00:00:32,079
ありがとうございます

9
00:00:32,079 --> 00:00:39,819
ちょっと読み辛い名前なんですけど、だいたい噛みやすいですけど、そんな感じなんで、よろしくお願いします。

10
00:00:39,819 --> 00:00:43,978
台湾人です。日本にいてもう9年経ちました。

11
00:00:43,978 --> 00:00:53,978
なのでもう日本語でOKです。どうぞ。っていう感じですけど、LINE DIGITAL FRONTIER 株式会社に勤めていて、趣味はです。

12
00:00:53,978 --> 00:00:57,298
漫画とかアニメビーチューパーとかですね

13
00:00:57,298 --> 00:01:01,039
オタク趣味がほとんどですけど

14
00:01:01,039 --> 00:01:05,840
天気がいい日にはバイク乗ってですね

15
00:01:05,840 --> 00:01:09,239
ツーリングに出かけたりする感じなんです

16
00:01:09,239 --> 00:01:12,180
写真通りなんですけど

17
00:01:12,180 --> 00:01:14,918
本題に入りますけど

18
00:01:14,918 --> 00:01:17,840
本日のエハマートなんですね

19
00:01:17,840 --> 00:01:20,780
そもそもなぜうちがですね

20
00:01:20,780 --> 00:01:23,739
ログシステムを移行しないといけないとか

21
00:01:23,739 --> 00:01:28,519
ログキーパードの構築にあたる設計とか実装とか

22
00:01:28,519 --> 00:01:32,918
テストコードをですねピンポイントで話していこうと思います

23
00:01:32,918 --> 00:01:37,078
時間の都合でですね全部紹介するのは難しいので

24
00:01:37,078 --> 00:01:39,039
話すコードで紹介する感じですね

25
00:01:39,039 --> 00:01:46,500
スイプト言語はスイプト6.1.0スイプト6で実装する感じになっていますね

26
00:01:46,500 --> 00:01:50,078
移行作業ですね今回はですね新規導入じゃなくてですね

27
00:01:50,918 --> 00:01:54,418
旧システムから新しいシステムに移行するような

28
00:01:54,418 --> 00:01:56,438
具体的な作業とかも話します

29
00:01:56,438 --> 00:02:01,978
リリースのピンポイントで希望な話になっているので

30
00:02:01,978 --> 00:02:06,597
安全な段階的リリースみたいなアプローチを取りました

31
00:02:06,597 --> 00:02:08,657
というような感じなんですね

32
00:02:08,657 --> 00:02:14,937
まずサンプルコードは個人のGitHubに上げております

33
00:02:14,937 --> 00:02:19,836
興味があればダウンロードして遊んでみてください

34
00:02:19,836 --> 00:02:25,538
本日大切は全部このサンプルコードにすべてありますので

35
00:02:25,538 --> 00:02:27,377
ぜひご参考ください

36
00:02:27,377 --> 00:02:32,959
まずそもそも移行しなければならないという話になりますけれども

37
00:02:32,959 --> 00:02:39,276
実は今LINEマンガリンもすでにいろんなログがありますと

38
00:02:39,276 --> 00:02:44,560
このログシステムは省略したコンテンツで終了しちゃいます

39
00:02:44,560 --> 00:02:45,800
なくなります

40
00:02:45,800 --> 00:02:47,639
サーバーことなくなります

41
00:02:47,639 --> 00:02:50,300
っていう感じなんで

42
00:02:50,300 --> 00:02:51,657
もうたたんちゃったら

43
00:02:51,657 --> 00:02:53,800
新しいログとか

44
00:02:53,800 --> 00:02:55,157
取らなきゃいけないので

45
00:02:55,157 --> 00:02:57,199
新しいシステムを導入しないと

46
00:02:57,199 --> 00:02:58,717
って感じなんですけど

47
00:02:58,717 --> 00:03:01,336
要はやるしかないですよ

48
00:03:01,336 --> 00:03:04,699
こういう話になったら

49
00:03:04,699 --> 00:03:07,000
サービスで新しい基板とか

50
00:03:07,000 --> 00:03:08,836
SDKとか

51
00:03:08,836 --> 00:03:11,479
ないですかってお願いするんじゃないですか

52
00:03:11,479 --> 00:03:15,318
基板とかライブラリでもいいから

53
00:03:15,318 --> 00:03:16,776
なんでもいいからくださいよ

54
00:03:16,776 --> 00:03:17,979
っていう感じなんですけど

55
00:03:17,979 --> 00:03:21,657
それがないんですよという答えが得られました

56
00:03:21,657 --> 00:03:25,500
じゃあ自分で作るしかないですね

57
00:03:25,500 --> 00:03:26,836
分かりましたとですね

58
00:03:26,836 --> 00:03:29,000
まず基盤からですね

59
00:03:29,000 --> 00:03:30,560
作ることになりました

60
00:03:30,560 --> 00:03:33,098
その前にですね

61
00:03:33,098 --> 00:03:37,157
そもそもログって何っていう話なんですけど

62
00:03:37,157 --> 00:03:43,919
ライマンガではユーザーの行動を取るログを指していますね

63
00:03:43,919 --> 00:03:45,157
例えばですけど

64
00:03:45,157 --> 00:03:52,276
画面遷移とかインプレッションとかね ここ大体ハンドとかビューとかボタンとか画像とか

65
00:03:52,276 --> 00:03:59,538
画面に侵入して視認できるようになっている状態をインプレッションと言いますけど

66
00:03:59,538 --> 00:04:07,639
大体みんな知ってると思うんですけど あとタップとか あとはドラッグとかスワイプとかみたいなジェスチャー

67
00:04:07,639 --> 00:04:11,959
それはユーザーの口頭としてあるオブジェなんですね

68
00:04:11,959 --> 00:04:16,100
何かデータを作って送信するように

69
00:04:16,100 --> 00:04:21,980
それは実際いろんな役割があるんですよね

70
00:04:21,980 --> 00:04:25,079
例えば作品のレコメントとか

71
00:04:25,079 --> 00:04:30,120
大体どんな経路でどういう作品を読んでいるか

72
00:04:30,120 --> 00:04:34,480
ユーザーがそこらへんを取って役に立ちますと

73
00:04:34,480 --> 00:04:35,620
なので大事ですと

74
00:04:35,620 --> 00:04:39,180
一方 複合調査とかにも役に立つんですね

75
00:04:39,180 --> 00:04:44,459
例えばとある原因不明なクラッシュを観測しましたと

76
00:04:44,459 --> 00:04:48,579
じゃあその特定ユーザーのログを見てですね

77
00:04:48,579 --> 00:04:51,620
クラッシュ直線まで何やっていたか

78
00:04:51,620 --> 00:04:55,459
そういったトレースの調査集計にいますと

79
00:04:55,459 --> 00:05:00,019
なので結構メインな機能じゃないですが大事ですと

80
00:05:00,019 --> 00:05:07,980
話した通りライバル側はすでに様々なログを仕込んでいて

81
00:05:07,980 --> 00:05:13,180
今回はですねログをどう取っていかかわるわけではなくて

82
00:05:13,180 --> 00:05:17,060
ログをどうやってサーバーに送信するかができるようになります

83
00:05:17,060 --> 00:05:19,000
それについて話していこうと思います

84
00:05:19,000 --> 00:05:22,600
移行の要件になりますけれども

85
00:05:22,600 --> 00:05:25,879
新規導入じゃなくて移行なんですね

86
00:05:25,879 --> 00:05:28,959
なんで今書いた通りなんですけど

87
00:05:28,959 --> 00:05:34,620
実際ログを集計している立場からしてはなるべくそのままにしてください

88
00:05:34,620 --> 00:05:41,060
ログ構造とデータと名前そういった基盤の実際というお願いがありましたと

89
00:05:41,060 --> 00:05:45,879
DOTM機能も提供してほしいですと

90
00:05:45,879 --> 00:05:50,040
移行期間中にならしとしてですねリアルセント

91
00:05:50,040 --> 00:05:57,519
要は旧システム新システム同時に存在している状態で両方にログ送信するんですと

92
00:05:57,519 --> 00:06:01,579
これはそのままにしてくださいの一つで

93
00:06:01,579 --> 00:06:04,278
強制アップデート今回は行わないですと

94
00:06:04,278 --> 00:06:05,720
そういうふうに言われました

95
00:06:05,720 --> 00:06:10,699
これはこの後のリリース計画に大いに関わるので

96
00:06:10,699 --> 00:06:12,240
ここはちょっと覚えておきましょう

97
00:06:12,240 --> 00:06:15,720
ログシステムについて

98
00:06:15,720 --> 00:06:17,798
要件は分かったんですけど

99
00:06:17,798 --> 00:06:20,439
ログシステムは結局どんな感じなので

100
00:06:20,439 --> 00:06:22,620
そもそも結構大事な要件

101
00:06:22,620 --> 00:06:25,379
メインストレートをブロックしてはいけないですね

102
00:06:25,379 --> 00:06:27,059
悪名のログを送信するんだから

103
00:06:27,059 --> 00:06:30,980
あまりにシステムリソースを使わずに

104
00:06:30,980 --> 00:06:33,918
だいたい漫画はみんなめちゃくちゃ読んでるので

105
00:06:33,918 --> 00:06:35,980
カフカフすると嫌ですと

106
00:06:35,980 --> 00:06:38,677
メモリアップしてはいけないし

107
00:06:38,677 --> 00:06:41,240
通信には抑えたいですと

108
00:06:41,240 --> 00:06:44,559
それにつないで話なんですけど

109
00:06:44,559 --> 00:06:48,500
結構縛りが厳しいですと

110
00:06:48,500 --> 00:06:51,600
こう言われても分からないので

111
00:06:51,600 --> 00:06:56,759
もうちょっと技術スペックみたいなことに落とします

112
00:06:56,759 --> 00:07:00,559
まずこういった通りに私が考えたのは

113
00:07:00,559 --> 00:07:04,860
データ型をデジタルのキーをストリングにして

114
00:07:04,860 --> 00:07:06,379
また入手法も抑えたいですと

115
00:07:06,379 --> 00:07:13,459
メインストレートを妨げるとは言えないとか言われたので

116
00:07:13,459 --> 00:07:16,720
今からの引き取り処理ですね

117
00:07:16,720 --> 00:07:18,860
別のストレートを切ってですね

118
00:07:18,860 --> 00:07:20,740
パレオティをUTUTにして

119
00:07:20,740 --> 00:07:23,360
そんな感じでですね

120
00:07:23,360 --> 00:07:26,220
平行で送信処理をするんですと

121
00:07:26,220 --> 00:07:28,759
値を1000Wにするとか

122
00:07:28,759 --> 00:07:32,177
直接送信即時送信せずにね

123
00:07:32,177 --> 00:07:34,418
一時保存するんですと

124
00:07:34,418 --> 00:07:37,000
通信についてはね

125
00:07:37,000 --> 00:07:38,579
データ量を制御したいので

126
00:07:38,579 --> 00:07:39,798
圧縮を行います

127
00:07:39,798 --> 00:07:42,177
ガンジップとかデフレットは

128
00:07:42,177 --> 00:07:43,879
考えられる手段ですね

129
00:07:43,879 --> 00:07:45,980
QoSを担保にするのに

130
00:07:45,980 --> 00:07:48,220
エクスポネンシャルバックオフみたいな

131
00:07:48,220 --> 00:07:49,860
リトライをバッファーとかデータの

132
00:07:49,860 --> 00:07:50,798
映像カードですね

133
00:07:50,798 --> 00:07:54,177
この基盤はもちろん

134
00:07:54,177 --> 00:07:55,100
せっかくだからね

135
00:07:55,100 --> 00:08:01,379
sweeped packageにしてですね 6.1.0.6を指定しますと

136
00:08:01,379 --> 00:08:07,939
これが大体決まったスペックですね その前にですね 実装に入る前にですね

137
00:08:07,939 --> 00:08:13,819
sweeped 6のポイントについてちょっと お伝えするのを入れるといい

138
00:08:13,819 --> 00:08:17,720
まずsweeped 6に開けたらね まず build errorめちゃくちゃ上がって

139
00:08:17,720 --> 00:08:22,079
できますよね 大体それを改善していくとなんとか

140
00:08:22,079 --> 00:08:25,557
なります 具体的に何のエラーだいたいsendable

141
00:08:25,557 --> 00:08:28,079
なんですよ なのでsendableを付ければいいです

142
00:08:28,079 --> 00:08:32,177
まず sendableを付けるには変数を

143
00:08:32,177 --> 00:08:34,177
まあですけどだいたいみんな知って ると思うんですけどね

144
00:08:34,177 --> 00:08:38,557
でも作らないといけない場合ですね 変数を

145
00:08:38,557 --> 00:08:43,940
だったらactorにしましょう それは基本原則になっていきます

146
00:08:43,940 --> 00:08:46,460
ね あとのソースコードもだいたい

147
00:08:46,460 --> 00:08:48,700
そんな感じになってるんですけど はい

148
00:08:48,700 --> 00:08:51,259
でどうしてもsendableを適用できない 場合はね

149
00:08:51,259 --> 00:08:53,700
アンクチェックとセンタープルをピンポイントでつけましょう

150
00:08:53,700 --> 00:08:54,960
まず作らない

151
00:08:54,960 --> 00:08:58,200
一方ですね

152
00:08:58,200 --> 00:09:02,399
テストケースはこの後紹介するんですけど

153
00:09:02,399 --> 00:09:05,519
アンクチェックとセンタープルとかは適当につけているんですね

154
00:09:05,519 --> 00:09:07,480
プロダクションコードじゃないので

155
00:09:07,480 --> 00:09:11,500
そこは厳密に求めなくていいと私は考えました

156
00:09:11,500 --> 00:09:14,038
という感じですね

157
00:09:14,038 --> 00:09:15,038
次にちょっとね

158
00:09:15,038 --> 00:09:16,057
全て

159
00:09:16,057 --> 00:09:19,700
ストローブというものを紹介します

160
00:09:19,700 --> 00:09:22,360
まずそもそも6を即時送信しないので

161
00:09:22,360 --> 00:09:24,639
一時的保存するんじゃないですか

162
00:09:24,639 --> 00:09:26,860
なので送信の処理はね

163
00:09:26,860 --> 00:09:28,580
大体こういったロジックになります

164
00:09:28,580 --> 00:09:31,460
データストアみたいなものがあってですね

165
00:09:31,460 --> 00:09:35,580
データがある限りファイルルームを回してですね

166
00:09:35,580 --> 00:09:39,418
そのファイルルームの中で始まりの

167
00:09:39,418 --> 00:09:39,960
第一つ

168
00:09:39,960 --> 00:09:42,940
少しデータを取り出すと

169
00:09:42,940 --> 00:09:47,080
チャンクみたいな単位で送信します

170
00:09:47,080 --> 00:09:51,620
送信成功したデータを削除っていう感じで

171
00:09:51,620 --> 00:09:52,840
エラーになったらですね

172
00:09:52,840 --> 00:09:55,038
ファイルループから離脱して中断

173
00:09:55,038 --> 00:09:57,740
データストアからデータがなくなったらね

174
00:09:57,740 --> 00:09:58,860
ファイルループから

175
00:09:58,860 --> 00:10:01,580
データストアからね

176
00:10:01,580 --> 00:10:06,480
そんな第一ループは基本コアなロジックになりますけど

177
00:10:06,480 --> 00:10:09,980
このソースコードをちょっと着目していきましょう

178
00:10:09,980 --> 00:10:11,278
ここですね

179
00:10:11,278 --> 00:10:13,840
データストアみたいな

180
00:10:13,840 --> 00:10:17,057
こういった部品があるんですと

181
00:10:17,057 --> 00:10:18,480
あとネットワーククライアント

182
00:10:18,480 --> 00:10:21,658
あとそもそもこのファイルループを

183
00:10:21,658 --> 00:10:23,320
離れることになります

184
00:10:23,320 --> 00:10:25,759
これをディスパーチャーと呼びましょう

185
00:10:25,759 --> 00:10:30,677
データステンドという謎の構造体があるんじゃないですか

186
00:10:30,677 --> 00:10:33,139
これも何かしらの型になるんですと

187
00:10:33,139 --> 00:10:36,759
なのでここから横展開します

188
00:10:36,759 --> 00:10:40,019
何の話につながるというと

189
00:10:40,019 --> 00:10:42,677
アーキテクチャの話になりますね

190
00:10:42,677 --> 00:10:45,620
収める何かしらのクラスが必要ですよね

191
00:10:45,620 --> 00:10:47,798
何かしらの名前とかも

192
00:10:47,798 --> 00:10:49,158
名前を落としていきましょう

193
00:10:49,158 --> 00:10:49,557
例えば

194
00:10:49,557 --> 00:10:51,740
endetio tracking dataに

195
00:10:51,740 --> 00:10:53,158
閉じて名付けましょう

196
00:10:53,158 --> 00:10:55,278
ディスパーチャーですね

197
00:10:55,278 --> 00:10:57,557
トラッキングディスパーチャー

198
00:10:57,557 --> 00:10:59,399
SQLデータソードか

199
00:10:59,399 --> 00:11:00,840
ネットワークラウンドとか

200
00:11:00,840 --> 00:11:01,658
ハイフォークだけで

201
00:11:01,658 --> 00:11:02,759
名前を落としていきましょう

202
00:11:02,759 --> 00:11:04,820
実際外部に使われる

203
00:11:04,820 --> 00:11:05,379
パブリック

204
00:11:05,379 --> 00:11:08,658
まずさっき見たトラッカーですね

205
00:11:08,658 --> 00:11:10,158
そんな名前にします

206
00:11:10,158 --> 00:11:12,418
今見た通りですね

207
00:11:12,418 --> 00:11:15,100
レイヤーを切っているんですね

208
00:11:15,100 --> 00:11:17,879
なので部品からレイヤーを切れます

209
00:11:17,879 --> 00:11:20,639
見ても分からないと思うので

210
00:11:20,639 --> 00:11:22,120
図を書いてみました

211
00:11:22,120 --> 00:11:25,340
これは依存関係とプロトコル的語だけ

212
00:11:25,340 --> 00:11:26,658
表しているんですけど

213
00:11:26,658 --> 00:11:28,038
大体のインターフェースは

214
00:11:28,038 --> 00:11:29,980
トラックアウトになります

215
00:11:29,980 --> 00:11:33,379
例えば赤の部分はエンティティで

216
00:11:33,379 --> 00:11:34,639
ディスパーチャーじゃないですか

217
00:11:34,639 --> 00:11:37,340
間にプロトコル挟まれています

218
00:11:37,340 --> 00:11:42,600
ちなみにこういった図見たことありますでしょうか

219
00:11:42,600 --> 00:11:43,778
グリーンアクティシャルとか

220
00:11:43,778 --> 00:11:48,940
中にいっぱい丸が囲まれているんですね 比較してみましょう

221
00:11:48,940 --> 00:11:51,538
こんな構成になっています

222
00:11:51,538 --> 00:11:57,418
よく見てください矢印ですね 奥に向いている

223
00:11:57,418 --> 00:12:02,677
なので一応クリーンの中の矢印の原則に適しているんです

224
00:12:02,677 --> 00:12:08,278
なので一応なんちゃらクリーンアーキテクチャーにはなっている自然な構成になります

225
00:12:08,278 --> 00:12:13,418
要はテストしやすいこんな風な構成になります

226
00:12:13,418 --> 00:12:18,418
おさすがやすい構成になっています これがアーキテクチャですね全体像

227
00:12:18,418 --> 00:12:26,100
エンティティになりますけどこんな 簡単なデータになります要はit

228
00:12:26,100 --> 00:12:32,620
を振ってですねその中はドック の生データをそのままCLI化して

229
00:12:32,620 --> 00:12:40,460
ソースケースで依存定義しました もちろんセンタブルをつけています

230
00:12:40,460 --> 00:12:46,960
デュースケースはこんな構成なんですけど、ディスパーチャーの周りにプロトコルですね。

231
00:12:46,960 --> 00:12:50,759
そんな移動関係になっています。

232
00:12:50,759 --> 00:12:56,360
コードを落としていくとこうなりますけども、ディスパーチャーは保存するように、

233
00:12:56,360 --> 00:13:04,557
こんな構造タイヤの名前とディスクシナリの配列をパラメータとして取りますけど、

234
00:13:04,557 --> 00:13:09,557
データストアは、save、get、delete、よくあるCRUDだけなんでね。

235
00:13:09,557 --> 00:13:16,557
ネットワークライアントはもっと簡単です。ただ創出だけだから、エージェント関数です。

236
00:13:16,557 --> 00:13:23,557
メソッド1つ、セントログだけ通り、Sendable、絶対つけましょう。

237
00:13:23,557 --> 00:13:33,557
外側はあまり言うことなくて、単純にコンクリートなんで、こんな風にね、プロトコルに沿って実装すればいいです。

238
00:13:33,557 --> 00:13:38,320
これ後で話します いよいよ部品の実装になります

239
00:13:38,320 --> 00:13:44,960
ここのポイントですね もちろんご覧のとおり左下半分ですね

240
00:13:44,960 --> 00:13:50,399
データストアはまずですね こちらはSQLite 3を直接使っています

241
00:13:50,399 --> 00:13:57,480
と 見ている通りクリエイトテーブル のクエリですね こういうふうに定義

242
00:13:57,480 --> 00:14:02,600
しています カラムは2つしますね まずデータストア

243
00:14:02,600 --> 00:14:03,860
ヒートロブですね

244
00:14:03,860 --> 00:14:07,980
そのまま保存する感じのシンプルな構成になっています

245
00:14:07,980 --> 00:14:11,860
そもそもなぜSQLiteで言えるのか言われると思うんですので

246
00:14:11,860 --> 00:14:15,600
シンプルなスキーマーというのがまずあるんですと

247
00:14:15,600 --> 00:14:18,600
これからそもそもこういう構成はですね

248
00:14:18,600 --> 00:14:22,259
マイグレーションは今後多分起きないでしかない

249
00:14:22,259 --> 00:14:25,798
プライマリキーのインティーチャーとアプリライトで十分ですと

250
00:14:25,798 --> 00:14:29,100
これはですね

251
00:14:29,100 --> 00:14:31,879
iOS標準搭載しているので

252
00:14:31,879 --> 00:14:33,580
ライブラリ全部いらないです

253
00:14:33,580 --> 00:14:36,278
なので今回はシンプルに

254
00:14:36,278 --> 00:14:38,778
SQLiteを採用していく感じですね

255
00:14:38,778 --> 00:14:41,158
早速実装したいじゃないですか

256
00:14:41,158 --> 00:14:43,576
それすぐ壁にぶつかります

257
00:14:43,576 --> 00:14:45,317
ということはまずあるんで

258
00:14:45,317 --> 00:14:48,980
SQLiteはポインター扱うんですよ

259
00:14:48,980 --> 00:14:53,220
SuiteではOpacポインターのポインターで扱うんですけど

260
00:14:53,220 --> 00:14:57,240
残念ながらこれはSuite Evolution 0.3.3.1で

261
00:14:57,240 --> 00:14:59,038
1000W外されましたと

262
00:14:59,038 --> 00:15:00,538
どうしてもですね

263
00:15:00,538 --> 00:15:02,740
これはビルド取らないです

264
00:15:02,740 --> 00:15:05,076
じゃあどうしたいかというと

265
00:15:05,076 --> 00:15:06,639
なぜかというと

266
00:15:06,639 --> 00:15:08,538
CEライブラリなんで

267
00:15:08,538 --> 00:15:10,480
Unchecked Center to付けます

268
00:15:10,480 --> 00:15:13,720
なのでこんなラッパーを用意します

269
00:15:13,720 --> 00:15:17,740
中にオープンエクスポインターを隠蔽しますと

270
00:15:17,740 --> 00:15:20,460
もちろん何しらセンダーブルーじゃなくてですね

271
00:15:20,460 --> 00:15:22,940
こういう風にロックをかけてあげます

272
00:15:22,940 --> 00:15:24,418
そしたら少なくとも

273
00:15:24,418 --> 00:15:26,658
こいつは安全ですと

274
00:15:26,658 --> 00:15:27,899
見えますか

275
00:15:27,899 --> 00:15:30,619
ピンポイントです

276
00:15:30,619 --> 00:15:32,379
データベースポイント

277
00:15:32,379 --> 00:15:34,359
の中にインペースしているので

278
00:15:34,359 --> 00:15:35,240
こういう風に

279
00:15:35,240 --> 00:15:38,038
スッキリな状態になりますし

280
00:15:38,038 --> 00:15:39,980
ちゃんとセンターブレードですよと

281
00:15:39,980 --> 00:15:42,519
CRUDの

282
00:15:42,519 --> 00:15:44,019
実装は今回は

283
00:15:44,019 --> 00:15:44,759
割愛します

284
00:15:44,759 --> 00:15:47,500
SU-Liteを

285
00:15:47,500 --> 00:15:49,177
加えまわしてですね

286
00:15:49,177 --> 00:15:52,317
適用した後はこういう風な構成になります

287
00:15:52,317 --> 00:15:53,259
できるでしょうみんな

288
00:15:53,259 --> 00:15:54,859
それだけなんで

289
00:15:54,859 --> 00:15:56,399
頑張っていきましょう

290
00:15:56,399 --> 00:16:02,298
冗談です サンプルコードになるので 見てくださいって感じなんですけど

291
00:16:02,298 --> 00:16:07,019
テストですね ちょっと話すんですけど

292
00:16:07,019 --> 00:16:13,200
まずCLIUDだけなので IO処理を実装するだけなので

293
00:16:13,200 --> 00:16:23,639
ここに着目するのは suite.curlizeというマクロを付けてるんですね

294
00:16:23,639 --> 00:16:26,859
なぜかというとファイルシステムを直接やるので

295
00:16:26,859 --> 00:16:29,298
Suite Testingはそもそも

296
00:16:29,298 --> 00:16:30,158
Devはですね

297
00:16:30,158 --> 00:16:32,778
AXEテストと違って

298
00:16:32,778 --> 00:16:35,960
正常系だけテストすればいいですと

299
00:16:35,960 --> 00:16:38,460
なのでテストケースでこれ走ると

300
00:16:38,460 --> 00:16:40,038
めちゃくちゃ恐怖するので

301
00:16:40,038 --> 00:16:41,778
ゴアシーラライズにしましょう

302
00:16:41,778 --> 00:16:43,139
ここはポイントですね

303
00:16:43,139 --> 00:16:44,576
はい

304
00:16:44,576 --> 00:16:48,118
データベースは以上です

305
00:16:48,118 --> 00:16:50,278
次はネットワーククラウドですね

306
00:16:50,278 --> 00:16:53,298
この図の右下の部分ですけど

307
00:16:53,298 --> 00:16:56,919
まず平行処理なんですよ

308
00:16:56,919 --> 00:16:57,759
全部コンカレント

309
00:16:57,759 --> 00:17:01,576
クライアント回しを直接ハードコードせずに

310
00:17:01,576 --> 00:17:04,240
こういう風にプロトコルを挟みます

311
00:17:04,240 --> 00:17:07,519
圧縮することはあるんじゃないですか

312
00:17:07,519 --> 00:17:12,700
なので5kBを一応仮にそう決めていて

313
00:17:12,700 --> 00:17:15,440
ボディを圧縮するように

314
00:17:15,440 --> 00:17:20,355
URLセッション運営のHTTPですね

315
00:17:20,355 --> 00:17:28,817
for networkingです リトライの待機時間を回すタックスリップ

316
00:17:28,817 --> 00:17:35,400
を取り扱うサスペンの関数もclosure として入れますと

317
00:17:35,400 --> 00:17:41,180
sendですね これが定数を定義します

318
00:17:41,180 --> 00:17:47,880
こういうふうにdebletのサイズに 入ったらヘッダーにエンコーディング

319
00:17:47,880 --> 00:17:54,115
を付けて圧縮しますそうでない 場合は普通に送信します

320
00:17:54,115 --> 00:18:00,000
後半はリトライの部分なんですけど リピードファイルを回してこういう

321
00:18:00,000 --> 00:18:04,960
風にプロトコルコンフォーマンス の本体の前半ですけど挟みつつ

322
00:18:04,960 --> 00:18:12,278
送信しますと 圧縮アルゴリズムはここではglib

323
00:18:12,278 --> 00:18:19,240
を使いますねサーバー次第なんですけど どういった圧縮アルゴリズムなん

324
00:18:19,240 --> 00:18:26,336
でもいいんで受け付ければいい と思いますしサスペンターを試したん

325
00:18:26,336 --> 00:18:32,680
ですけどうまくいかなかったんで 古き良きglibを使って実装しました

326
00:18:32,680 --> 00:18:38,960
とテストをちょっとします話します けどこういった風にこういう構成

327
00:18:38,960 --> 00:18:44,140
なんですね 全部Mockで収入できます なので待機秒数も全然拾えます

328
00:18:44,140 --> 00:18:48,380
ちなみにCompletion Planwork Apple更新 のやつなんですけど ネットワーキング

329
00:18:48,380 --> 00:18:54,076
を収入して こういった観測できます ね 最初の送信と3回リトライで

330
00:18:54,076 --> 00:18:59,778
合計4回送信っていうアサイズを かけられますし 秒数は248 2の

331
00:18:59,778 --> 00:19:06,640
炎上みたいな感じですね 拾えます ゆるいディスパッチャーなんですけど

332
00:19:06,640 --> 00:19:11,880
例えばこういう400エラーを回数 データストア ネットワーク&エラー

333
00:19:11,880 --> 00:19:17,700
ハンドラーみたいな作った部品 を入れて取り扱うように

334
00:19:17,700 --> 00:19:21,920
タスクですね ここだけバーが現れました

335
00:19:21,920 --> 00:19:27,140
アクターですね アクターでやるんですね

336
00:19:27,140 --> 00:19:35,200
プラスアルファでセキュリティー をオーバーライドします

337
00:19:35,200 --> 00:19:42,200
なぜそうしないといけないかというと、処理を単純にするためなんですよ。

338
00:19:42,200 --> 00:19:57,200
Actorってそもそも内部のバーのデータレースを、ここをExecutor内部の処理の順番とかはもう分からないですよね。

339
00:19:57,200 --> 00:20:15,680
なのでここはあえてシーラライズ化にして、そもそもこのドックシステムは単純な構成なので、別にそんなにコンカルエントを求めていないから、とりあえずシーラライズを回避してくれるんですけど、案内をしました。

340
00:20:15,680 --> 00:20:23,420
ダイジェストループなんですね。こういうふうに見覚えあると思うんですけど、ファイルループをタスクの中に入れて、シーラライズをしているだけですね。

341
00:20:24,355 --> 00:20:31,038
第一次党の本体なんで、ちなみにちょっとですね、イールドを最後に入れています。

342
00:20:31,038 --> 00:20:38,880
この関数はですね、そんな風にですね、ちょっとね、タスクツリーと思っていいですね。

343
00:20:38,880 --> 00:20:45,680
目的としては、他の優先順位の高いものに譲るんですよね、優先順位を。

344
00:20:45,680 --> 00:20:52,057
これは結構いい感じの構成なんで、こういう風にここにタスクイールドを入れましたと。

345
00:20:53,880 --> 00:21:00,880
時間未定の送信

346
00:21:00,880 --> 00:21:03,220
そして送信成功した削除

347
00:21:03,220 --> 00:21:05,000
という感じですね

348
00:21:05,000 --> 00:21:06,920
データの保存です

349
00:21:06,920 --> 00:21:10,440
何か大切な開始と終了

350
00:21:10,440 --> 00:21:12,420
の関数を用意します

351
00:21:12,420 --> 00:21:14,115
プロトコルをConfirmanceですね

352
00:21:14,115 --> 00:21:16,720
シリーズ化して送信

353
00:21:16,720 --> 00:21:18,596
JetTor本体なんですね

354
00:21:18,596 --> 00:21:20,759
ここは単純にデータを取り出して

355
00:21:20,759 --> 00:21:23,380
もちろん全部Mockにします

356
00:21:23,380 --> 00:21:26,700
例えばこんな感じなんですけども

357
00:21:26,700 --> 00:21:28,640
全部観測できますね

358
00:21:28,640 --> 00:21:32,336
なので適当に70件のログ入れますと

359
00:21:32,336 --> 00:21:34,778
6件入れて大手術を開始すると

360
00:21:34,778 --> 00:21:37,220
2回送信されました

361
00:21:37,220 --> 00:21:39,557
71件ね

362
00:21:39,557 --> 00:21:45,400
テストも次に大手術と並行処理ですね

363
00:21:45,400 --> 00:21:48,519
タスクグループのめちゃくちゃ大手術を開始してみて

364
00:21:48,519 --> 00:21:54,700
結局重複送信もせずにいい感じに配送されました

365
00:21:54,700 --> 00:21:57,420
トラッカーですね本体

366
00:21:57,420 --> 00:21:59,778
これはもう何もしなくていいんで

367
00:21:59,778 --> 00:22:03,778
部品を全部送信されているというダーサーシーンがかけられます

368
00:22:03,778 --> 00:22:06,298
使い方はこんな感じですね

369
00:22:06,298 --> 00:22:08,317
本体に本物を入れます

370
00:22:08,317 --> 00:22:10,836
タスクスリープをちゃんとここに入れて

371
00:22:10,836 --> 00:22:12,836
ネットワーキングも用意している瞬間とか

372
00:22:12,836 --> 00:22:14,980
隠蔽したラッパーを入れます

373
00:22:14,980 --> 00:22:18,019
テストカバー値はこういう風に

374
00:22:18,019 --> 00:22:20,355
小さいですけど82.6%です

375
00:22:20,355 --> 00:22:21,278
まあまあ高いです

376
00:22:21,278 --> 00:22:23,115
取り入れて

377
00:22:23,115 --> 00:22:26,220
何ようなインターフェースを用意すればいいです

378
00:22:26,220 --> 00:22:28,700
これで終わりなわけじゃないですよね

379
00:22:28,700 --> 00:22:30,400
移行作業に入ります

380
00:22:30,400 --> 00:22:32,700
例えばこんな

381
00:22:32,700 --> 00:22:37,000
現状はオールドログみたいなものがございますと

382
00:22:37,000 --> 00:22:40,259
ここから今作ったトラッカーに

383
00:22:40,259 --> 00:22:42,115
DRセントにしたいですと

384
00:22:42,115 --> 00:22:44,220
そしたらこういった

385
00:22:44,220 --> 00:22:47,336
ようやく基盤が完成しました

386
00:22:47,336 --> 00:22:51,557
このラッパーの中に2つ送信しますと

387
00:22:51,557 --> 00:22:54,440
残念ながらこれはできませんでした

388
00:22:54,440 --> 00:22:58,180
なぜかというとログはですね

389
00:22:58,180 --> 00:23:01,160
現実はそううまくいかないから

390
00:23:01,160 --> 00:23:06,096
このまま送信できるログはそもそも多くなかったんですね

391
00:23:06,096 --> 00:23:09,400
当たったパターンは考えられますね

392
00:23:09,400 --> 00:23:12,278
とりあえずこのアプローチを取ると

393
00:23:12,278 --> 00:23:15,336
大量なマッピング同時区がこうなります

394
00:23:15,336 --> 00:23:17,519
結構すごいことになるので

395
00:23:17,519 --> 00:23:21,660
性能もあんまり良くないので

396
00:23:21,660 --> 00:23:23,057
これはもう断念しますと

397
00:23:23,057 --> 00:23:26,740
じゃあどうしたいかというと

398
00:23:26,740 --> 00:23:27,900
根性でいきます

399
00:23:27,900 --> 00:23:31,660
そもそもAPIのインターフェースも紙はないし

400
00:23:31,660 --> 00:23:33,778
ログコールをですね

401
00:23:33,778 --> 00:23:36,160
あらかじめ全て洗い出して

402
00:23:36,160 --> 00:23:38,140
一個ずつ直していきます

403
00:23:38,140 --> 00:23:41,660
作業が膨大で普通に大変ですと

404
00:23:42,278 --> 00:23:52,057
全てダメじゃないですよね。正直ですね、性能は正直ピンポイントで直しているので、性能はそもそも根性でいけます。

405
00:23:52,057 --> 00:24:02,400
全てとりあえずですね、この毒何?みたいなことを議論しつつね、いらないものを消していきます。

406
00:24:02,400 --> 00:24:04,836
リファクタリングというわけですよね。

407
00:24:06,836 --> 00:24:09,500
やるにはこういうタイミングなんですよ

408
00:24:09,500 --> 00:24:11,440
出ないといつまでもいい

409
00:24:11,440 --> 00:24:13,298
引くときにいいですと

410
00:24:13,298 --> 00:24:16,180
せっかく見直したので

411
00:24:16,180 --> 00:24:18,240
実際にやったことは

412
00:24:18,240 --> 00:24:19,596
例えばこんなログ

413
00:24:19,596 --> 00:24:22,200
タップとしてサンプルにしてるんですけど

414
00:24:22,200 --> 00:24:24,740
オールドタップイベントログがあります

415
00:24:24,740 --> 00:24:28,500
トラッカーにも新しいタップイベントを提起していますと

416
00:24:28,500 --> 00:24:32,115
これそれぞれ基盤にAPMをしてる

417
00:24:32,115 --> 00:24:34,200
できないから

418
00:24:34,200 --> 00:24:37,480
モチーフとして取っていきますと

419
00:24:37,480 --> 00:24:39,740
こういう風にですね

420
00:24:39,740 --> 00:24:41,836
新しい方につないでいきますと

421
00:24:41,836 --> 00:24:42,038
はい

422
00:24:42,038 --> 00:24:45,038
こういう風につないでいきますね

423
00:24:45,038 --> 00:24:45,317
こう

424
00:24:45,317 --> 00:24:49,400
セルフを返してるんですよ

425
00:24:49,400 --> 00:24:51,920
なのでフルエンドインターフェースになりますね

426
00:24:51,920 --> 00:24:53,200
こういう風に

427
00:24:53,200 --> 00:24:56,400
こういう風につないでいけば

428
00:24:56,400 --> 00:24:57,759
オールドの方ですね

429
00:24:57,759 --> 00:24:59,855
古い方にメソッドを増やします

430
00:24:59,855 --> 00:25:01,259
やりやすいまず

431
00:25:01,259 --> 00:25:03,940
こう書いてあるので

432
00:25:03,940 --> 00:25:07,019
目視で分かるこれまでより線と対応済みですと

433
00:25:07,019 --> 00:25:10,596
なので特に手動修正いらない

434
00:25:10,596 --> 00:25:12,880
ログに関してはこういう風に

435
00:25:12,880 --> 00:25:15,420
いい感じのメソッドを挟めばいい

436
00:25:15,420 --> 00:25:16,880
という感じになります

437
00:25:16,880 --> 00:25:18,519
あれですね

438
00:25:18,519 --> 00:25:22,200
Fluent in my faceなんで

439
00:25:22,200 --> 00:25:24,700
並べて個別実装にします

440
00:25:24,700 --> 00:25:28,317
例えばこの例なんですけど

441
00:25:28,317 --> 00:25:30,400
キーを変えましたね

442
00:25:30,400 --> 00:25:32,700
item.itをnew item.itに変えました

443
00:25:32,700 --> 00:25:38,278
実際私がやった作業ではこんな単純な作業だけじゃないのでいっぱいありました

444
00:25:38,278 --> 00:25:43,817
個別修正が必要な箇所はこういう風に

445
00:25:43,817 --> 00:25:46,519
ですけど普通に大変だったんですよ

446
00:25:46,519 --> 00:25:54,019
もう作業の途中から自分一体何やってるんだろうみたいな

447
00:25:54,019 --> 00:25:58,220
私はなんでここにいるんだという人生を疑いましたね

448
00:25:58,220 --> 00:26:03,298
という孤独がいくつかあって何か頑張りました

449
00:26:03,298 --> 00:26:09,000
結果なんでそういう気持ちを抱えつつもですね

450
00:26:09,000 --> 00:26:15,160
この毒一体何やみたいな議論を繰り返してですね

451
00:26:15,160 --> 00:26:18,038
結果的にペイロードサイズをまあまあ削減できましたと

452
00:26:18,038 --> 00:26:20,480
共通パラメータもですねいっぱいあったんですけど

453
00:26:20,480 --> 00:26:22,700
いらないよねって決めたらもう

454
00:26:22,700 --> 00:26:25,038
本当に作業量が非常に膨大でした

455
00:26:25,038 --> 00:26:29,640
データ量を減らせましたと

456
00:26:29,640 --> 00:26:31,298
古いシステムもこのまま

457
00:26:31,298 --> 00:26:33,057
マス抜きなんですけどね

458
00:26:33,057 --> 00:26:34,798
これで

459
00:26:34,798 --> 00:26:37,538
移行作業の話でした

460
00:26:37,538 --> 00:26:41,038
次にですね

461
00:26:41,038 --> 00:26:44,440
物を作ったのでリリースしないといけないし

462
00:26:44,440 --> 00:26:46,920
新しいシステムは

463
00:26:46,920 --> 00:26:48,076
我々

464
00:26:48,076 --> 00:26:51,220
理由の話はしたけど

465
00:26:51,220 --> 00:26:53,740
メリットいっぱいありますね

466
00:26:53,740 --> 00:26:55,880
みんなある程度やってると思うんですけど

467
00:26:55,880 --> 00:26:59,200
キャラリアリリースみたいなやり方で

468
00:26:59,200 --> 00:27:00,836
メリットいっぱいありますと

469
00:27:00,836 --> 00:27:03,720
問題が発見しましたら

470
00:27:03,720 --> 00:27:05,019
すぐに止めてですね

471
00:27:05,019 --> 00:27:06,480
自決可能です

472
00:27:06,480 --> 00:27:08,480
リリース計画になりますと

473
00:27:08,480 --> 00:27:12,180
段階的な移行につながって

474
00:27:12,180 --> 00:27:13,817
フォトフィックス出さなきゃいけない

475
00:27:13,817 --> 00:27:15,096
ためになったらですね

476
00:27:15,096 --> 00:27:17,538
だいぶすごい大変な作業になります

477
00:27:17,538 --> 00:27:19,538
いっぱい人が動く行動になります

478
00:27:19,538 --> 00:27:23,096
なのでこういう大規模な移行については

479
00:27:23,096 --> 00:27:26,576
とりあえず単外的に行こうかお勧めですね

480
00:27:26,576 --> 00:27:28,000
制御可能にします

481
00:27:28,000 --> 00:27:30,940
メリットいっぱいあるんですけど

482
00:27:30,940 --> 00:27:33,660
大きな事故については

483
00:27:33,660 --> 00:27:35,836
徐々に開放していくので

484
00:27:35,836 --> 00:27:37,557
こんな感じで

485
00:27:37,557 --> 00:27:39,960
すでにいっぱい一気にリリースしちゃうと

486
00:27:39,960 --> 00:27:40,900
新しいシステム

487
00:27:40,900 --> 00:27:42,596
サーバー担当も

488
00:27:42,596 --> 00:27:44,519
サーバー耐えられるか分からないか

489
00:27:44,519 --> 00:27:45,836
とかあるので

490
00:27:45,836 --> 00:27:48,596
本当にこれが必要ですと

491
00:27:48,596 --> 00:27:50,115
ちなみになんですけど

492
00:27:50,115 --> 00:27:54,836
サーバー復活の分散に関しても

493
00:27:54,836 --> 00:27:58,038
そういう側面に対しても何かしらの対策が必要なんです

494
00:27:58,038 --> 00:28:00,096
なぜかというと

495
00:28:00,096 --> 00:28:03,660
強制アップデートを行わないとですね

496
00:28:03,660 --> 00:28:09,440
ずっと古いアプリを使い続けるユーザーはですね

497
00:28:09,440 --> 00:28:11,778
ずっと古いシステムに

498
00:28:11,778 --> 00:28:13,440
まだ覚えていますか皆さん

499
00:28:13,440 --> 00:28:16,057
強制アップデートは行わないです

500
00:28:16,057 --> 00:28:19,057
なのでこれによって送信活動を続けてしまいます

501
00:28:19,057 --> 00:28:22,240
さっき話した通りサーバーなくなりますよ

502
00:28:22,240 --> 00:28:27,096
なんで404存在しないサーバーにずっとデータを送る羽目になります

503
00:28:27,096 --> 00:28:31,317
なのでそもそも強制アップデートをなぜ送らないと

504
00:28:31,317 --> 00:28:35,440
純粋にユーザーのデータをどこに送っちゃうんですよね

505
00:28:35,440 --> 00:28:38,115
なので強制アップデートをしてあげないと

506
00:28:38,115 --> 00:28:43,680
そうした間を取る手段を考えなければならないですね

507
00:28:43,680 --> 00:28:48,519
なんで話した通りアップデートをしたいユーザーは

508
00:28:48,519 --> 00:28:51,576
旧システムに送信し続けてしまう

509
00:28:51,576 --> 00:28:54,440
コスト削減とかも話します

510
00:28:54,440 --> 00:28:56,440
ハードル差分とか

511
00:28:56,440 --> 00:28:59,420
UXに関する懸念があるわけで

512
00:28:59,420 --> 00:29:00,759
なるべくしないように

513
00:29:00,759 --> 00:29:02,057
制御が必要ですね

514
00:29:02,057 --> 00:29:04,096
旧システムに対しては

515
00:29:04,096 --> 00:29:07,538
ログを遮断するフラグを用意します

516
00:29:07,538 --> 00:29:09,576
新しいシステムに対しては

517
00:29:09,576 --> 00:29:11,057
段階的にロールアウトなので

518
00:29:11,057 --> 00:29:13,980
それもフラグを用意して

519
00:29:13,980 --> 00:29:16,400
ユーザーの割合に対して

520
00:29:16,400 --> 00:29:18,278
上陣上陣変えようと思うんですけど

521
00:29:18,278 --> 00:29:21,180
なのでこういう風に

522
00:29:21,180 --> 00:29:22,480
2パターンの

523
00:29:22,480 --> 00:29:25,596
遮断制御はデフはツルーで

524
00:29:25,596 --> 00:29:26,615
全開放します

525
00:29:26,615 --> 00:29:28,380
ハードコード

526
00:29:28,380 --> 00:29:31,259
例えばプラグが存在しない場合

527
00:29:31,259 --> 00:29:33,920
コード上ハードコードする値を

528
00:29:33,920 --> 00:29:35,200
フォルスにします

529
00:29:35,200 --> 00:29:37,798
逆ドローの方は

530
00:29:37,798 --> 00:29:38,557
逆ですね

531
00:29:38,557 --> 00:29:40,115
フォルスが起こしていきます

532
00:29:40,115 --> 00:29:43,298
ここに着目するのは

533
00:29:43,298 --> 00:29:46,096
不適な状態にします

534
00:29:46,096 --> 00:29:51,519
なのでフラッグはFirebase上から最終的に消せます

535
00:29:51,519 --> 00:29:59,420
消したら最終的な状態に動くので

536
00:29:59,420 --> 00:30:02,880
こういった設定になりますからスルーに変えます

537
00:30:02,880 --> 00:30:06,076
いずれもデフォルトの値は

538
00:30:06,076 --> 00:30:12,140
最終2024年10月にもうすでに遮断の制御を事前にリリースしました

539
00:30:12,140 --> 00:30:24,880
なので結構1年前ぐらいこのツールの値がほぼ全ユーザーに時間で持ちますね

540
00:30:24,880 --> 00:30:27,000
実績になりますけど

541
00:30:27,000 --> 00:30:33,817
実装も1ヶ月を挟んで制御実装を入れました

542
00:30:33,817 --> 00:30:40,380
なので旧システムに対しては何も起きませんでしたみたいな感じになります

543
00:30:40,380 --> 00:30:43,140
もちろんもうフラグ仕込んでいるので

544
00:30:43,140 --> 00:30:46,076
後でフラグをかけてですね

545
00:30:46,076 --> 00:30:50,057
フラグが振動するように事前にリリースしますと

546
00:30:50,057 --> 00:30:53,680
制御時に強制アップデートせずに済むんですと

547
00:30:53,680 --> 00:30:57,740
新しいシステムの実績はこうなりますけど

548
00:30:57,740 --> 00:31:03,115
これはね今年1月にもフラグをフォルスにして100%公開しました

549
00:31:03,115 --> 00:31:08,076
4月にですね全部変えればね

550
00:31:08,076 --> 00:31:10,298
旧システムの送信も全部なくなります

551
00:31:10,298 --> 00:31:11,660
という感じですね

552
00:31:11,660 --> 00:31:15,940
それで4月の10日あたりですね

553
00:31:15,940 --> 00:31:17,038
リリースにしましたと

554
00:31:17,038 --> 00:31:19,680
カレンダーバージョニングは

555
00:31:19,680 --> 00:31:20,640
うち採用しているので

556
00:31:20,640 --> 00:31:22,855
リリース時期はここら辺ですと

557
00:31:22,855 --> 00:31:25,000
分かりやすいです

558
00:31:25,000 --> 00:31:27,115
5段階に分けてですね

559
00:31:27,115 --> 00:31:30,038
こういう風にリリース機能に

560
00:31:30,038 --> 00:31:31,038
なんていうか

561
00:31:31,038 --> 00:31:34,380
新しいシステムの6実装全部一括で

562
00:31:34,380 --> 00:31:36,557
一時的にゼロパーにしました

563
00:31:36,557 --> 00:31:39,200
それをなんとか直してですね

564
00:31:39,200 --> 00:31:43,000
問題なかったので50%までスキルして

565
00:31:43,000 --> 00:31:46,460
この後スケジュールという実績になります

566
00:31:46,460 --> 00:31:48,298
結果ですね

567
00:31:48,298 --> 00:31:49,856
ホットフィックスはなかったし

568
00:31:49,856 --> 00:31:53,557
4月上旬にですね

569
00:31:53,557 --> 00:31:55,278
削減ちょっとね

570
00:31:55,278 --> 00:31:56,836
副は観測してですね

571
00:31:56,836 --> 00:31:59,219
安心することは非常に大事ですよね

572
00:31:59,219 --> 00:32:01,659
焦ることは本当に大変なので

573
00:32:01,659 --> 00:32:07,759
本当に音品な集団でリリースすることはお勧めします

574
00:32:07,759 --> 00:32:13,960
フラグの制御とかも結構めちゃくちゃ良かったです

575
00:32:13,960 --> 00:32:16,778
物理的安定性もいいし

576
00:32:16,778 --> 00:32:19,576
心理的安定性も特に決めたので

577
00:32:19,576 --> 00:32:21,980
こういうふうにですね

578
00:32:21,980 --> 00:32:26,317
残りなくフラグを永遠に消せないよみたいな状態を作らない

579
00:32:26,317 --> 00:32:29,159
強制アベイドももちろんしなかったんです

580
00:32:29,159 --> 00:32:34,159
今はですねまたデュアルセンドの期間中なので

581
00:32:34,798 --> 00:32:39,635
計画の段階でこういうふうにツルフォルス運営の話をします

582
00:32:39,635 --> 00:32:44,317
アフターリリースはその後はモニタリングして

583
00:32:44,317 --> 00:32:46,076
クラシアがあったら修正します

584
00:32:46,076 --> 00:32:48,900
原因調査で修正するなり

585
00:32:48,900 --> 00:32:50,278
あとはまだやってないですけど

586
00:32:50,278 --> 00:32:51,798
制御フラッグの削除とか

587
00:32:51,798 --> 00:32:53,778
急実装の削除とか

588
00:32:53,778 --> 00:32:56,219
そういったタスクを残ったりする

589
00:32:56,219 --> 00:33:00,356
なのであと少しです

590
00:33:00,356 --> 00:33:03,199
実は全部消します

591
00:33:03,199 --> 00:33:09,538
一気に2000行の赤い数字の差分を出したいですね

592
00:33:09,538 --> 00:33:13,400
まだですけど期待したいです

593
00:33:13,400 --> 00:33:16,856
というわけでゴールまであと少しでございます

594
00:33:16,856 --> 00:33:23,179
これがエンジニアとしては一番ワクワクなフェースなんですけど

595
00:33:23,179 --> 00:33:28,179
いらないと何とコードログって何とかの話をしました

596
00:33:28,179 --> 00:33:35,259
DigestDubという結構最初に考えたコアのロジックから

597
00:33:35,259 --> 00:33:38,635
インターフェース設計とかアーキテクチャの話に展開しました

598
00:33:38,635 --> 00:33:41,980
まとめに入ります

599
00:33:41,980 --> 00:33:44,000
まずですね

600
00:33:44,000 --> 00:33:47,798
ログシステムそもそもいただきましたと

601
00:33:47,798 --> 00:33:49,798
テストコードですね

602
00:33:49,798 --> 00:33:52,420
ピンポイントで紹介しましたけど

603
00:33:52,420 --> 00:33:57,636
フルなソースコードはサンプルエポジトにあるので見てください

604
00:33:57,636 --> 00:34:00,960
もちろんですねここは自社製なんですよ

605
00:34:00,960 --> 00:34:03,940
基本的にもちろんクリーンソリッドの構成になっています

606
00:34:03,940 --> 00:34:07,799
スイブットシックスに基づいた実装で紹介させて

607
00:34:07,799 --> 00:34:10,820
話は外部の人とかに頼らずにですね

608
00:34:10,820 --> 00:34:13,400
実車で解決します

609
00:34:13,400 --> 00:34:15,800
これが内製化のメリットなんですけどね

610
00:34:15,800 --> 00:34:18,920
その皮に私が大変なんですけど

611
00:34:18,920 --> 00:34:21,199
冗談です

612
00:34:21,199 --> 00:34:23,360
我々は基盤作りは今日も楽しいですよ

613
00:34:23,360 --> 00:34:25,000
全て私が作りましたので

614
00:34:25,000 --> 00:34:27,960
これから機能の拡張とか

615
00:34:27,960 --> 00:34:29,619
何かつけたいとか

616
00:34:29,619 --> 00:34:31,260
まとめその2ですけど

617
00:34:31,260 --> 00:34:33,940
Eコースアギュラーアプローチを紹介しました

618
00:34:33,940 --> 00:34:39,360
エレガントのアタウターパターンもあるんですけれども

619
00:34:39,360 --> 00:34:43,099
現実はそううまくいかないんですよね

620
00:34:43,099 --> 00:34:44,518
普通はそう

621
00:34:44,518 --> 00:34:47,719
皆さんぜひそのチャンスあればやってみてください

622
00:34:47,719 --> 00:34:49,860
全然怖くないです

623
00:34:49,860 --> 00:34:53,079
食いしばって根性でいきます

624
00:34:53,079 --> 00:34:55,260
ぜひ根性でいきましょう

625
00:34:55,260 --> 00:34:57,619
根性でいきました

626
00:34:57,619 --> 00:35:00,300
結局良かったんですね

627
00:35:00,300 --> 00:35:03,559
リパークリングもできましたし

628
00:35:03,559 --> 00:35:04,940
いい感じでしたと

629
00:35:04,940 --> 00:35:06,699
ヘルパーメソッドとか

630
00:35:06,699 --> 00:35:08,739
理想はあくまで理想

631
00:35:08,739 --> 00:35:10,559
っていうことなんですけど

632
00:35:10,559 --> 00:35:11,800
なので基本的には

633
00:35:11,800 --> 00:35:14,420
ハーフなんですね

634
00:35:14,420 --> 00:35:16,739
要点としては

635
00:35:16,739 --> 00:35:18,518
旧システムに対しては

636
00:35:18,518 --> 00:35:20,179
フォローを設定してから

637
00:35:20,179 --> 00:35:21,239
ツールに変えます

638
00:35:21,239 --> 00:35:22,900
逆だった

639
00:35:22,900 --> 00:35:26,199
trueに設定しからfalseに変えます

640
00:35:26,199 --> 00:35:28,820
新しいシステムのドルアウトに対しては

641
00:35:28,820 --> 00:35:30,900
具体的な手段を紹介しました

642
00:35:30,900 --> 00:35:32,940
ソースコードを介してですね

643
00:35:32,940 --> 00:35:34,760
まとめその3ですけど

644
00:35:34,760 --> 00:35:36,480
ここは簡単構成になりますので

645
00:35:36,480 --> 00:35:39,280
こういったアレンジがいいと思います

646
00:35:39,280 --> 00:35:42,679
強制アップデートをせずにするんですね

647
00:35:42,679 --> 00:35:45,599
参考になればと思いますけれども

648
00:35:45,599 --> 00:35:47,360
5段階はうち

649
00:35:47,360 --> 00:35:49,739
今回ドルアウトは5段階分けたんですけど

650
00:35:49,739 --> 00:35:52,760
VoltsからTrueに変えます

651
00:35:52,760 --> 00:35:56,699
Configは消せるように

652
00:35:56,699 --> 00:36:00,380
基本なログ基盤を作った感じなんですけど

653
00:36:00,380 --> 00:36:02,760
やることはまだいっぱいあるんですよね

654
00:36:02,760 --> 00:36:05,699
CPUの使用率とかメモリに合わせてですね

655
00:36:05,699 --> 00:36:07,559
ソーセンペースを調整するなり

656
00:36:07,559 --> 00:36:09,440
そういった工夫は考えられます

657
00:36:09,440 --> 00:36:11,860
ゲームアプリとかリアルタイムアプリみたいな

658
00:36:11,860 --> 00:36:13,579
結構ねパフォーマンス高く分けていいので

659
00:36:13,579 --> 00:36:15,360
ここはもうお好きなように

660
00:36:15,360 --> 00:36:17,980
おまけなんですけど

661
00:36:17,980 --> 00:36:20,059
結構気にもいますし

662
00:36:20,059 --> 00:36:24,340
そもそもディスク容量が結構まずいユーザーはね

663
00:36:24,340 --> 00:36:27,659
そもそもデータベースは開けられないというパターンがあるので

664
00:36:27,659 --> 00:36:29,139
そこはですね

665
00:36:29,139 --> 00:36:32,340
インメモリデータストアとかにフォールバックしてですね

666
00:36:32,340 --> 00:36:34,440
そういうふうにですね

667
00:36:34,440 --> 00:36:36,840
本当に厳しいアプリに関しては

668
00:36:36,840 --> 00:36:41,639
独自システムはここら辺のファクターを考慮してもいいと思いますので

669
00:36:41,639 --> 00:36:43,340
こういった手段を見ますね

670
00:36:43,340 --> 00:36:45,559
オフタン環境ではですね

671
00:36:45,559 --> 00:36:50,000
例えば飛行機にいる中で送信できないから

672
00:36:50,000 --> 00:36:52,699
リーチアビリティを監視してですね

673
00:36:52,699 --> 00:36:54,239
配送の送信しないように

674
00:36:54,239 --> 00:37:00,139
Wi-Fiが入ったら基盤の挙動を変えずに

675
00:37:00,139 --> 00:37:03,380
依存させ替えれば今もいないですけど

676
00:37:03,380 --> 00:37:05,420
繰り返しになりますが

677
00:37:05,420 --> 00:37:08,619
デファレンス、ソース、リボットとですね

678
00:37:08,619 --> 00:37:10,360
サンプルコードこちらにあります

679
00:37:10,360 --> 00:37:11,440
ぜひご覧ください

680
00:37:11,440 --> 00:37:13,920
ちょっとした宣伝なんですが

681
00:37:13,920 --> 00:37:15,340
アフターイベントをやります

682
00:37:15,340 --> 00:37:20,059
ここはですねちょっとした前提をめちゃくちゃ送信していきますと

683
00:37:20,059 --> 00:37:22,840
そういった工夫は考えられます

684
00:37:22,840 --> 00:37:24,940
以上となります

685
00:37:24,940 --> 00:37:28,280
時間は来月10月17日

686
00:37:28,280 --> 00:37:30,480
まだちょっと先なんですが19時ですね

687
00:37:30,480 --> 00:37:36,079
場所はうちのオフィス六本木東京ミッドタウン11階になります

688
00:37:36,079 --> 00:37:39,940
ライコンバースページはここにあるのでぜひいらして

689
00:37:39,940 --> 00:37:41,480
ラインマンガの裏話とか

690
00:37:41,480 --> 00:37:43,440
E-BOOKS JAPANとかの裏話を

691
00:37:43,440 --> 00:37:45,539
話す予定だと思います

692
00:37:45,539 --> 00:37:49,000
開発のすべてを

693
00:37:49,000 --> 00:37:51,320
話しさせていただきました

694
00:37:51,320 --> 00:37:53,860
ご清聴ありがとうございました

695
00:37:53,860 --> 00:38:04,059
おいしいご飯を用意しております

696
00:38:04,059 --> 00:38:05,440
以上

697
00:38:05,440 --> 00:38:07,039
ラインマンガを支える

698
00:38:07,039 --> 00:38:08,659
独機版の設計

699
00:38:08,659 --> 00:38:11,179
質問のある方は手を挙げてお知らせください

700
00:38:11,179 --> 00:38:17,099
お願いいたします

701
00:38:17,099 --> 00:38:18,139
マイクお持ちします

702
00:38:18,139 --> 00:38:19,940
ありがとうございました

703
00:38:19,940 --> 00:38:23,659
結構行動がクリーンアーキテクト

704
00:38:23,659 --> 00:38:26,119
発表ありがとうございました

705
00:38:26,119 --> 00:38:29,340
それではQ&Aに入りたいと思います

706
00:38:29,340 --> 00:38:32,940
コメントや質問を書くと理解も深まるというか

707
00:38:32,940 --> 00:38:35,380
僕は割とプロダクトファイアベースを使っているし

708
00:38:35,380 --> 00:38:38,518
送ってしまってその辺の理解も勉強できるといいなというのは

709
00:38:38,518 --> 00:38:39,420
自分でも思いました

710
00:38:39,420 --> 00:38:41,920
これは最終的にリリースする前に

711
00:38:41,920 --> 00:38:43,518
開発期間とか

712
00:38:43,518 --> 00:38:45,739
人数はどのくらいで開発しないと

713
00:38:45,739 --> 00:38:47,179
きれいですし

714
00:38:47,179 --> 00:38:49,739
テストもしやすい構図になっているのが

715
00:38:49,739 --> 00:38:51,300
すごくいいなって思いましたし

716
00:38:51,300 --> 00:38:52,559
そこをやっぱり自分で

717
00:38:52,559 --> 00:38:55,119
開発は私一人です

718
00:38:55,119 --> 00:38:56,320
なので

719
00:38:56,320 --> 00:38:59,219
レバランスめちゃ少ないじゃないですか

720
00:38:59,219 --> 00:38:59,760
Gboot

721
00:38:59,760 --> 00:39:01,659
コンプレッションプレミアムしかない

722
00:39:01,659 --> 00:39:03,539
全部私が考えました

723
00:39:03,539 --> 00:39:05,559
すごい

724
00:39:05,559 --> 00:39:09,739
最終的な今のリリースまでに

725
00:39:09,739 --> 00:39:11,679
こぎつけたって感じだったんでしょうか

726
00:39:11,679 --> 00:39:13,840
言っていいですかそもそも

727
00:39:13,840 --> 00:39:15,260
こういう風にですね

728
00:39:15,260 --> 00:39:16,619
1000万ダウンロード

729
00:39:16,619 --> 00:39:18,360
という規模の

730
00:39:18,360 --> 00:39:20,139
ノグ基盤はこれでいきましたので

731
00:39:20,139 --> 00:39:21,900
ぜひ参考にしてみてください

732
00:39:21,900 --> 00:39:23,119
開発期間はですね

733
00:39:23,119 --> 00:39:25,079
1年以上かかりましたね

734
00:39:25,079 --> 00:39:27,559
そもそも作業は非常に多かったんで

735
00:39:27,559 --> 00:39:29,820
あと作業にはですね

736
00:39:29,820 --> 00:39:31,739
根拠のない自信が必要なんですよ

737
00:39:31,739 --> 00:39:33,599
ってないと何も始まらないので

738
00:39:33,599 --> 00:39:39,099
結果オーライでしたら コンサート半ぐらいかな わかんないですけど

739
00:39:39,099 --> 00:39:42,300
AIとかも結構活用 根性ってあったんですけど

740
00:39:42,300 --> 00:39:47,099
ある程度AIとかを活用して 天ぷらのところは直すみたいなのできるのかなとか思ったんですけど

741
00:39:47,099 --> 00:39:48,099
やっぱりそれは難しいですか

742
00:39:48,099 --> 00:39:55,099
今年からの仕事は悪かしじゃない やり取り運もいっぱいありましたので

743
00:39:55,099 --> 00:40:01,099
そういった感じで大体1年ちょっと投入があれですけど

744
00:40:01,099 --> 00:40:04,380
考案してちょっと考えました

745
00:40:04,380 --> 00:40:06,179
ちなみにこういったコースはですね

746
00:40:06,179 --> 00:40:10,480
他の方とか知見のある方とも話してましたので

747
00:40:10,480 --> 00:40:12,480
こんなコースでまず行きます

748
00:40:12,480 --> 00:40:14,099
AI導入してるんですけど

749
00:40:14,099 --> 00:40:15,739
これはですね去年やったので

750
00:40:15,739 --> 00:40:19,518
特にAIツール使ってなかったんですね

751
00:40:19,518 --> 00:40:20,159
お知事は

752
00:40:20,159 --> 00:40:23,079
ご質問のある方ありましたら挙手をお願いいたします

753
00:40:23,079 --> 00:40:26,460
マイクお持ちいたしますので少々お待ちください

754
00:40:31,099 --> 00:40:35,199
聞けそう

755
00:40:35,199 --> 00:40:37,039
ガチ根性であったところです

756
00:40:37,039 --> 00:40:38,159
ありがとうございます

757
00:40:38,159 --> 00:40:40,639
ありがとうございました

758
00:40:40,639 --> 00:40:42,139
他にコメントや

759
00:40:42,139 --> 00:40:47,400
人生を疑うとか根性が大切とかっていう話はすごい共感できました

760
00:40:47,400 --> 00:40:50,400
ちょっと質問なんですけど

761
00:40:50,400 --> 00:40:52,619
要件のところに書いてあった

762
00:40:52,619 --> 00:40:56,599
ログ送信の時のメモリーショー

763
00:40:56,599 --> 00:40:58,840
面白い発表ありがとうございました

764
00:40:58,840 --> 00:41:06,518
自分もちょっとユーザーコードログのライブラリを社内で開発しているのでやってたのかが気になりまして

765
00:41:06,518 --> 00:41:15,860
その辺自分たちでテストのアプリを作ってそのライブラリを導入してベンチマークを新旧で取るのか

766
00:41:15,860 --> 00:41:23,119
あるいはそのサービスのアプリにある日とか電力消費とかの要件に入ってたと思うんですけど

767
00:41:23,119 --> 00:41:25,739
そこら辺の検証をどういうふうに

768
00:41:25,739 --> 00:41:31,239
ベンチマークはですね、正直やっていませんでした。

769
00:41:31,239 --> 00:41:36,239
スケジュールの都合上とかもありますし、

770
00:41:36,239 --> 00:41:40,239
そもそもこの構成はもうだいぶミニアムの

771
00:41:40,239 --> 00:41:44,239
どれ程度組み込んでやってもらったりしたのかっていうのをお聞きしたいです。

772
00:41:44,239 --> 00:41:48,239
はい、そこら辺ですね、一応考えてはいます。

773
00:41:48,239 --> 00:41:50,239
みたいなアプローチをとります。

774
00:41:50,239 --> 00:41:52,239
まずリリースしてからアートを考えます。

775
00:41:52,239 --> 00:41:54,239
みたいなアプローチをとります。

776
00:41:54,239 --> 00:42:13,460
そしてですね、普通にエスコートのインストゥルメントは自分で見てるんですけど、特に問題なかったので、とりあえずリースしてみましょうという構成になっているので、まず問題起きたらね、まず止めてですね、みんなちょっと答えていけなくたという感じです。申し訳ございません。

777
00:42:13,460 --> 00:42:15,480
いいえ、大丈夫です。ありがとうございます。

778
00:42:15,480 --> 00:42:18,059
ありがとうございました。

779
00:42:18,059 --> 00:42:23,960
お時間的に次が最後になりそうです。コメントやご質問の方は挙手をお願いいたします。

780
00:42:24,000 --> 00:42:24,980
アプローチを取りました

781
00:42:24,980 --> 00:42:26,820
ベンジマークはですね

782
00:42:26,820 --> 00:42:29,980
私ちょっとあんまり

783
00:42:29,980 --> 00:42:31,280
慣れていなかったので

784
00:42:31,280 --> 00:42:31,639
そこは

785
00:42:31,639 --> 00:42:37,780
次回になりましたので

786
00:42:37,780 --> 00:42:40,659
これでQ&Aを終了させていただきます

787
00:42:40,659 --> 00:42:42,460
続いて1分間フィードバックの