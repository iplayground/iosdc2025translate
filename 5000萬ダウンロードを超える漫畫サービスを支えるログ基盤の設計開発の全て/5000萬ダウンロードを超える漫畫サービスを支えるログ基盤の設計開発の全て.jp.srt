1
00:00:00,000 --> 00:00:29,980
ご視聴ありがとうございました

2
00:00:30,000 --> 00:00:59,979
ご視聴ありがとうございました

3
00:01:00,000 --> 00:01:29,980
ご視聴ありがとうございました

4
00:01:30,000 --> 00:01:59,980
ご視聴ありがとうございました

5
00:02:00,000 --> 00:02:06,879
iOS DC JAPAN 2025

6
00:02:06,879 --> 00:02:09,099
トラックC

7
00:02:09,099 --> 00:02:10,680
NEXT

8
00:02:10,680 --> 00:02:17,199
5000万ダウンロードを超える漫画サービスを支える

9
00:02:17,199 --> 00:02:20,259
ログ基盤の設計開発のすべて

10
00:02:20,259 --> 00:02:25,199
デスケーサー

11
00:02:25,960 --> 00:02:35,879
本日はですね

12
00:02:35,879 --> 00:02:39,659
5000万ダウンロードを超える漫画サービス

13
00:02:39,659 --> 00:02:45,159
もとい電子コミックサービスを支えるログ基盤の設計開発のすべて

14
00:02:45,159 --> 00:02:46,500
それを題してですね

15
00:02:46,500 --> 00:02:48,840
話していこうと思います

16
00:02:48,840 --> 00:02:52,620
ちょっとした自己紹介なんですけど

17
00:02:52,620 --> 00:02:54,539
デスクスと申します

18
00:02:54,539 --> 00:02:55,080
ありがとうございます

19
00:02:55,080 --> 00:03:02,819
ちょっと読み辛い名前なんですけど、だいたい噛みやすいですけど、そんな感じなんで、よろしくお願いします。

20
00:03:02,819 --> 00:03:06,979
台湾人です。日本にいてもう9年経ちました。

21
00:03:06,979 --> 00:03:16,979
なのでもう日本語でOKです。どうぞ。っていう感じですけど、LINE DIGITAL FRONTIER 株式会社に勤めていて、趣味はです。

22
00:03:16,979 --> 00:03:20,300
漫画とかアニメビーチューパーとかですね

23
00:03:20,300 --> 00:03:24,039
オタク趣味がほとんどですけど

24
00:03:24,039 --> 00:03:28,840
天気がいい日にはバイク乗ってですね

25
00:03:28,840 --> 00:03:32,240
ツーリングに出かけたりする感じなんです

26
00:03:32,240 --> 00:03:35,180
写真通りなんですけど

27
00:03:35,180 --> 00:03:37,919
本題に入りますけど

28
00:03:37,919 --> 00:03:40,840
本日のエハマートなんですね

29
00:03:40,840 --> 00:03:43,780
そもそもなぜうちがですね

30
00:03:43,780 --> 00:03:46,740
ログシステムを移行しないといけないとか

31
00:03:46,740 --> 00:03:51,520
ログキーパードの構築にあたる設計とか実装とか

32
00:03:51,520 --> 00:03:55,919
テストコードをですねピンポイントで話していこうと思います

33
00:03:55,919 --> 00:04:00,080
時間の都合でですね全部紹介するのは難しいので

34
00:04:00,080 --> 00:04:02,039
話すコードで紹介する感じですね

35
00:04:02,039 --> 00:04:09,500
スイプト言語はスイプト6.1.0スイプト6で実装する感じになっていますね

36
00:04:09,500 --> 00:04:13,080
移行作業ですね今回はですね新規導入じゃなくてですね

37
00:04:13,919 --> 00:04:17,420
旧システムから新しいシステムに移行するような

38
00:04:17,420 --> 00:04:19,439
具体的な作業とかも話します

39
00:04:19,439 --> 00:04:24,980
リリースのピンポイントで希望な話になっているので

40
00:04:24,980 --> 00:04:29,600
安全な段階的リリースみたいなアプローチを取りました

41
00:04:29,600 --> 00:04:31,660
というような感じなんですね

42
00:04:31,660 --> 00:04:37,939
まずサンプルコードは個人のGitHubに上げております

43
00:04:37,939 --> 00:04:42,839
興味があればダウンロードして遊んでみてください

44
00:04:42,839 --> 00:04:48,540
本日大切は全部このサンプルコードにすべてありますので

45
00:04:48,540 --> 00:04:50,379
ぜひご参考ください

46
00:04:50,379 --> 00:04:55,959
まずそもそも移行しなければならないという話になりますけれども

47
00:04:55,959 --> 00:05:02,279
実は今LINEマンガリンもすでにいろんなログがありますと

48
00:05:02,279 --> 00:05:07,560
このログシステムは省略したコンテンツで終了しちゃいます

49
00:05:07,560 --> 00:05:08,800
なくなります

50
00:05:08,800 --> 00:05:10,639
サーバーことなくなります

51
00:05:10,639 --> 00:05:13,300
っていう感じなんで

52
00:05:13,300 --> 00:05:14,660
もうたたんちゃったら

53
00:05:14,660 --> 00:05:16,800
新しいログとか

54
00:05:16,800 --> 00:05:18,160
取らなきゃいけないので

55
00:05:18,160 --> 00:05:20,199
新しいシステムを導入しないと

56
00:05:20,199 --> 00:05:21,720
って感じなんですけど

57
00:05:21,720 --> 00:05:24,339
要はやるしかないですよ

58
00:05:24,339 --> 00:05:27,699
こういう話になったら

59
00:05:27,699 --> 00:05:30,000
サービスで新しい基板とか

60
00:05:30,000 --> 00:05:31,839
SDKとか

61
00:05:31,839 --> 00:05:34,480
ないですかってお願いするんじゃないですか

62
00:05:34,480 --> 00:05:38,319
基板とかライブラリでもいいから

63
00:05:38,319 --> 00:05:39,779
なんでもいいからくださいよ

64
00:05:39,779 --> 00:05:40,980
っていう感じなんですけど

65
00:05:40,980 --> 00:05:44,660
それがないんですよという答えが得られました

66
00:05:44,660 --> 00:05:48,500
じゃあ自分で作るしかないですね

67
00:05:48,500 --> 00:05:49,839
分かりましたとですね

68
00:05:49,839 --> 00:05:52,000
まず基盤からですね

69
00:05:52,000 --> 00:05:53,560
作ることになりました

70
00:05:53,560 --> 00:05:56,100
その前にですね

71
00:05:56,100 --> 00:06:00,160
そもそもログって何っていう話なんですけど

72
00:06:00,160 --> 00:06:06,920
ライマンガではユーザーの行動を取るログを指していますね

73
00:06:06,920 --> 00:06:08,160
例えばですけど

74
00:06:08,160 --> 00:06:15,279
画面遷移とかインプレッションとかね ここ大体ハンドとかビューとかボタンとか画像とか

75
00:06:15,279 --> 00:06:22,540
画面に侵入して視認できるようになっている状態をインプレッションと言いますけど

76
00:06:22,540 --> 00:06:30,639
大体みんな知ってると思うんですけど あとタップとか あとはドラッグとかスワイプとかみたいなジェスチャー

77
00:06:30,639 --> 00:06:34,959
それはユーザーの口頭としてあるオブジェなんですね

78
00:06:34,959 --> 00:06:39,100
何かデータを作って送信するように

79
00:06:39,100 --> 00:06:44,980
それは実際いろんな役割があるんですよね

80
00:06:44,980 --> 00:06:48,079
例えば作品のレコメントとか

81
00:06:48,079 --> 00:06:53,120
大体どんな経路でどういう作品を読んでいるか

82
00:06:53,120 --> 00:06:57,480
ユーザーがそこらへんを取って役に立ちますと

83
00:06:57,480 --> 00:06:58,620
なので大事ですと

84
00:06:58,620 --> 00:07:02,180
一方 複合調査とかにも役に立つんですね

85
00:07:02,180 --> 00:07:07,459
例えばとある原因不明なクラッシュを観測しましたと

86
00:07:07,459 --> 00:07:11,579
じゃあその特定ユーザーのログを見てですね

87
00:07:11,579 --> 00:07:14,620
クラッシュ直線まで何やっていたか

88
00:07:14,620 --> 00:07:18,459
そういったトレースの調査集計にいますと

89
00:07:18,459 --> 00:07:23,019
なので結構メインな機能じゃないですが大事ですと

90
00:07:23,019 --> 00:07:30,980
話した通りライバル側はすでに様々なログを仕込んでいて

91
00:07:30,980 --> 00:07:36,180
今回はですねログをどう取っていかかわるわけではなくて

92
00:07:36,180 --> 00:07:40,060
ログをどうやってサーバーに送信するかができるようになります

93
00:07:40,060 --> 00:07:42,000
それについて話していこうと思います

94
00:07:42,000 --> 00:07:45,600
移行の要件になりますけれども

95
00:07:45,600 --> 00:07:48,879
新規導入じゃなくて移行なんですね

96
00:07:48,879 --> 00:07:51,959
なんで今書いた通りなんですけど

97
00:07:51,959 --> 00:07:57,620
実際ログを集計している立場からしてはなるべくそのままにしてください

98
00:07:57,620 --> 00:08:04,060
ログ構造とデータと名前そういった基盤の実際というお願いがありましたと

99
00:08:04,060 --> 00:08:08,879
DOTM機能も提供してほしいですと

100
00:08:08,879 --> 00:08:13,040
移行期間中にならしとしてですねリアルセント

101
00:08:13,040 --> 00:08:20,519
要は旧システム新システム同時に存在している状態で両方にログ送信するんですと

102
00:08:20,519 --> 00:08:24,579
これはそのままにしてくださいの一つで

103
00:08:24,579 --> 00:08:27,279
強制アップデート今回は行わないですと

104
00:08:27,279 --> 00:08:28,720
そういうふうに言われました

105
00:08:28,720 --> 00:08:33,700
これはこの後のリリース計画に大いに関わるので

106
00:08:33,700 --> 00:08:35,240
ここはちょっと覚えておきましょう

107
00:08:35,240 --> 00:08:38,720
ログシステムについて

108
00:08:38,720 --> 00:08:40,799
要件は分かったんですけど

109
00:08:40,799 --> 00:08:43,440
ログシステムは結局どんな感じなので

110
00:08:43,440 --> 00:08:45,620
そもそも結構大事な要件

111
00:08:45,620 --> 00:08:48,379
メインストレートをブロックしてはいけないですね

112
00:08:48,379 --> 00:08:50,059
悪名のログを送信するんだから

113
00:08:50,059 --> 00:08:53,980
あまりにシステムリソースを使わずに

114
00:08:53,980 --> 00:08:56,919
だいたい漫画はみんなめちゃくちゃ読んでるので

115
00:08:56,919 --> 00:08:58,980
カフカフすると嫌ですと

116
00:08:58,980 --> 00:09:01,679
メモリアップしてはいけないし

117
00:09:01,679 --> 00:09:04,240
通信には抑えたいですと

118
00:09:04,240 --> 00:09:07,559
それにつないで話なんですけど

119
00:09:07,559 --> 00:09:11,500
結構縛りが厳しいですと

120
00:09:11,500 --> 00:09:14,600
こう言われても分からないので

121
00:09:14,600 --> 00:09:19,759
もうちょっと技術スペックみたいなことに落とします

122
00:09:19,759 --> 00:09:23,559
まずこういった通りに私が考えたのは

123
00:09:23,559 --> 00:09:27,860
データ型をデジタルのキーをストリングにして

124
00:09:27,860 --> 00:09:29,379
また入手法も抑えたいですと

125
00:09:29,379 --> 00:09:36,460
メインストレートを妨げるとは言えないとか言われたので

126
00:09:36,460 --> 00:09:39,720
今からの引き取り処理ですね

127
00:09:39,720 --> 00:09:41,860
別のストレートを切ってですね

128
00:09:41,860 --> 00:09:43,740
パレオティをUTUTにして

129
00:09:43,740 --> 00:09:46,360
そんな感じでですね

130
00:09:46,360 --> 00:09:49,220
平行で送信処理をするんですと

131
00:09:49,220 --> 00:09:51,759
値を1000Wにするとか

132
00:09:51,759 --> 00:09:55,179
直接送信即時送信せずにね

133
00:09:55,179 --> 00:09:57,419
一時保存するんですと

134
00:09:57,419 --> 00:10:00,000
通信についてはね

135
00:10:00,000 --> 00:10:01,580
データ量を制御したいので

136
00:10:01,580 --> 00:10:02,799
圧縮を行います

137
00:10:02,799 --> 00:10:05,179
ガンジップとかデフレットは

138
00:10:05,179 --> 00:10:06,879
考えられる手段ですね

139
00:10:06,879 --> 00:10:08,980
QoSを担保にするのに

140
00:10:08,980 --> 00:10:11,220
エクスポネンシャルバックオフみたいな

141
00:10:11,220 --> 00:10:12,860
リトライをバッファーとかデータの

142
00:10:12,860 --> 00:10:13,799
映像カードですね

143
00:10:13,799 --> 00:10:17,179
この基盤はもちろん

144
00:10:17,179 --> 00:10:18,100
せっかくだからね

145
00:10:18,100 --> 00:10:24,379
sweeped packageにしてですね 6.1.0.6を指定しますと

146
00:10:24,379 --> 00:10:30,940
これが大体決まったスペックですね その前にですね 実装に入る前にですね

147
00:10:30,940 --> 00:10:36,820
sweeped 6のポイントについてちょっと お伝えするのを入れるといい

148
00:10:36,820 --> 00:10:40,720
まずsweeped 6に開けたらね まず build errorめちゃくちゃ上がって

149
00:10:40,720 --> 00:10:45,080
できますよね 大体それを改善していくとなんとか

150
00:10:45,080 --> 00:10:48,559
なります 具体的に何のエラーだいたいsendable

151
00:10:48,559 --> 00:10:51,080
なんですよ なのでsendableを付ければいいです

152
00:10:51,080 --> 00:10:55,179
まず sendableを付けるには変数を

153
00:10:55,179 --> 00:10:57,179
まあですけどだいたいみんな知って ると思うんですけどね

154
00:10:57,179 --> 00:11:01,559
でも作らないといけない場合ですね 変数を

155
00:11:01,559 --> 00:11:06,940
だったらactorにしましょう それは基本原則になっていきます

156
00:11:06,940 --> 00:11:09,460
ね あとのソースコードもだいたい

157
00:11:09,460 --> 00:11:11,700
そんな感じになってるんですけど はい

158
00:11:11,700 --> 00:11:14,259
でどうしてもsendableを適用できない 場合はね

159
00:11:14,259 --> 00:11:16,700
アンクチェックとセンタープルをピンポイントでつけましょう

160
00:11:16,700 --> 00:11:17,960
まず作らない

161
00:11:17,960 --> 00:11:21,200
一方ですね

162
00:11:21,200 --> 00:11:25,399
テストケースはこの後紹介するんですけど

163
00:11:25,399 --> 00:11:28,519
アンクチェックとセンタープルとかは適当につけているんですね

164
00:11:28,519 --> 00:11:30,480
プロダクションコードじゃないので

165
00:11:30,480 --> 00:11:34,500
そこは厳密に求めなくていいと私は考えました

166
00:11:34,500 --> 00:11:37,039
という感じですね

167
00:11:37,039 --> 00:11:38,039
次にちょっとね

168
00:11:38,039 --> 00:11:39,059
全て

169
00:11:39,059 --> 00:11:42,700
ストローブというものを紹介します

170
00:11:42,700 --> 00:11:45,360
まずそもそも6を即時送信しないので

171
00:11:45,360 --> 00:11:47,639
一時的保存するんじゃないですか

172
00:11:47,639 --> 00:11:49,860
なので送信の処理はね

173
00:11:49,860 --> 00:11:51,580
大体こういったロジックになります

174
00:11:51,580 --> 00:11:54,460
データストアみたいなものがあってですね

175
00:11:54,460 --> 00:11:58,580
データがある限りファイルルームを回してですね

176
00:11:58,580 --> 00:12:02,419
そのファイルルームの中で始まりの

177
00:12:02,419 --> 00:12:02,960
第一つ

178
00:12:02,960 --> 00:12:05,940
少しデータを取り出すと

179
00:12:05,940 --> 00:12:10,080
チャンクみたいな単位で送信します

180
00:12:10,080 --> 00:12:14,620
送信成功したデータを削除っていう感じで

181
00:12:14,620 --> 00:12:15,840
エラーになったらですね

182
00:12:15,840 --> 00:12:18,039
ファイルループから離脱して中断

183
00:12:18,039 --> 00:12:20,740
データストアからデータがなくなったらね

184
00:12:20,740 --> 00:12:21,860
ファイルループから

185
00:12:21,860 --> 00:12:24,580
データストアからね

186
00:12:24,580 --> 00:12:29,480
そんな第一ループは基本コアなロジックになりますけど

187
00:12:29,480 --> 00:12:32,980
このソースコードをちょっと着目していきましょう

188
00:12:32,980 --> 00:12:34,279
ここですね

189
00:12:34,279 --> 00:12:36,840
データストアみたいな

190
00:12:36,840 --> 00:12:40,059
こういった部品があるんですと

191
00:12:40,059 --> 00:12:41,480
あとネットワーククライアント

192
00:12:41,480 --> 00:12:44,659
あとそもそもこのファイルループを

193
00:12:44,659 --> 00:12:46,320
離れることになります

194
00:12:46,320 --> 00:12:48,759
これをディスパーチャーと呼びましょう

195
00:12:48,759 --> 00:12:53,679
データステンドという謎の構造体があるんじゃないですか

196
00:12:53,679 --> 00:12:56,139
これも何かしらの型になるんですと

197
00:12:56,139 --> 00:12:59,759
なのでここから横展開します

198
00:12:59,759 --> 00:13:03,019
何の話につながるというと

199
00:13:03,019 --> 00:13:05,679
アーキテクチャの話になりますね

200
00:13:05,679 --> 00:13:08,620
収める何かしらのクラスが必要ですよね

201
00:13:08,620 --> 00:13:10,799
何かしらの名前とかも

202
00:13:10,799 --> 00:13:12,159
名前を落としていきましょう

203
00:13:12,159 --> 00:13:12,559
例えば

204
00:13:12,559 --> 00:13:14,740
endetio tracking dataに

205
00:13:14,740 --> 00:13:16,159
閉じて名付けましょう

206
00:13:16,159 --> 00:13:18,279
ディスパーチャーですね

207
00:13:18,279 --> 00:13:20,559
トラッキングディスパーチャー

208
00:13:20,559 --> 00:13:22,399
SQLデータソードか

209
00:13:22,399 --> 00:13:23,840
ネットワークラウンドとか

210
00:13:23,840 --> 00:13:24,659
ハイフォークだけで

211
00:13:24,659 --> 00:13:25,759
名前を落としていきましょう

212
00:13:25,759 --> 00:13:27,820
実際外部に使われる

213
00:13:27,820 --> 00:13:28,379
パブリック

214
00:13:28,379 --> 00:13:31,659
まずさっき見たトラッカーですね

215
00:13:31,659 --> 00:13:33,159
そんな名前にします

216
00:13:33,159 --> 00:13:35,419
今見た通りですね

217
00:13:35,419 --> 00:13:38,100
レイヤーを切っているんですね

218
00:13:38,100 --> 00:13:40,879
なので部品からレイヤーを切れます

219
00:13:40,879 --> 00:13:43,639
見ても分からないと思うので

220
00:13:43,639 --> 00:13:45,120
図を書いてみました

221
00:13:45,120 --> 00:13:48,340
これは依存関係とプロトコル的語だけ

222
00:13:48,340 --> 00:13:49,659
表しているんですけど

223
00:13:49,659 --> 00:13:51,039
大体のインターフェースは

224
00:13:51,039 --> 00:13:52,980
トラックアウトになります

225
00:13:52,980 --> 00:13:56,379
例えば赤の部分はエンティティで

226
00:13:56,379 --> 00:13:57,639
ディスパーチャーじゃないですか

227
00:13:57,639 --> 00:14:00,340
間にプロトコル挟まれています

228
00:14:00,340 --> 00:14:05,600
ちなみにこういった図見たことありますでしょうか

229
00:14:05,600 --> 00:14:06,779
グリーンアクティシャルとか

230
00:14:06,779 --> 00:14:11,940
中にいっぱい丸が囲まれているんですね 比較してみましょう

231
00:14:11,940 --> 00:14:14,539
こんな構成になっています

232
00:14:14,539 --> 00:14:20,419
よく見てください矢印ですね 奥に向いている

233
00:14:20,419 --> 00:14:25,679
なので一応クリーンの中の矢印の原則に適しているんです

234
00:14:25,679 --> 00:14:31,279
なので一応なんちゃらクリーンアーキテクチャーにはなっている自然な構成になります

235
00:14:31,279 --> 00:14:36,419
要はテストしやすいこんな風な構成になります

236
00:14:36,419 --> 00:14:41,419
おさすがやすい構成になっています これがアーキテクチャですね全体像

237
00:14:41,419 --> 00:14:49,100
エンティティになりますけどこんな 簡単なデータになります要はit

238
00:14:49,100 --> 00:14:55,620
を振ってですねその中はドック の生データをそのままCLI化して

239
00:14:55,620 --> 00:15:03,460
ソースケースで依存定義しました もちろんセンタブルをつけています

240
00:15:03,460 --> 00:15:09,960
デュースケースはこんな構成なんですけど、ディスパーチャーの周りにプロトコルですね。

241
00:15:09,960 --> 00:15:13,759
そんな移動関係になっています。

242
00:15:13,759 --> 00:15:19,360
コードを落としていくとこうなりますけども、ディスパーチャーは保存するように、

243
00:15:19,360 --> 00:15:27,559
こんな構造タイヤの名前とディスクシナリの配列をパラメータとして取りますけど、

244
00:15:27,559 --> 00:15:32,559
データストアは、save、get、delete、よくあるCRUDだけなんでね。

245
00:15:32,559 --> 00:15:39,559
ネットワークライアントはもっと簡単です。ただ創出だけだから、エージェント関数です。

246
00:15:39,559 --> 00:15:46,559
メソッド1つ、セントログだけ通り、Sendable、絶対つけましょう。

247
00:15:46,559 --> 00:15:56,559
外側はあまり言うことなくて、単純にコンクリートなんで、こんな風にね、プロトコルに沿って実装すればいいです。

248
00:15:56,559 --> 00:16:01,320
これ後で話します いよいよ部品の実装になります

249
00:16:01,320 --> 00:16:07,960
ここのポイントですね もちろんご覧のとおり左下半分ですね

250
00:16:07,960 --> 00:16:13,399
データストアはまずですね こちらはSQLite 3を直接使っています

251
00:16:13,399 --> 00:16:20,480
と 見ている通りクリエイトテーブル のクエリですね こういうふうに定義

252
00:16:20,480 --> 00:16:25,600
しています カラムは2つしますね まずデータストア

253
00:16:25,600 --> 00:16:26,860
ヒートロブですね

254
00:16:26,860 --> 00:16:30,980
そのまま保存する感じのシンプルな構成になっています

255
00:16:30,980 --> 00:16:34,860
そもそもなぜSQLiteで言えるのか言われると思うんですので

256
00:16:34,860 --> 00:16:38,600
シンプルなスキーマーというのがまずあるんですと

257
00:16:38,600 --> 00:16:41,600
これからそもそもこういう構成はですね

258
00:16:41,600 --> 00:16:45,259
マイグレーションは今後多分起きないでしかない

259
00:16:45,259 --> 00:16:48,799
プライマリキーのインティーチャーとアプリライトで十分ですと

260
00:16:48,799 --> 00:16:52,100
これはですね

261
00:16:52,100 --> 00:16:54,879
iOS標準搭載しているので

262
00:16:54,879 --> 00:16:56,580
ライブラリ全部いらないです

263
00:16:56,580 --> 00:16:59,279
なので今回はシンプルに

264
00:16:59,279 --> 00:17:01,779
SQLiteを採用していく感じですね

265
00:17:01,779 --> 00:17:04,160
早速実装したいじゃないですか

266
00:17:04,160 --> 00:17:06,579
それすぐ壁にぶつかります

267
00:17:06,579 --> 00:17:08,319
ということはまずあるんで

268
00:17:08,319 --> 00:17:11,980
SQLiteはポインター扱うんですよ

269
00:17:11,980 --> 00:17:16,220
SuiteではOpacポインターのポインターで扱うんですけど

270
00:17:16,220 --> 00:17:20,240
残念ながらこれはSuite Evolution 0.3.3.1で

271
00:17:20,240 --> 00:17:22,039
1000W外されましたと

272
00:17:22,039 --> 00:17:23,539
どうしてもですね

273
00:17:23,539 --> 00:17:25,740
これはビルド取らないです

274
00:17:25,740 --> 00:17:28,079
じゃあどうしたいかというと

275
00:17:28,079 --> 00:17:29,640
なぜかというと

276
00:17:29,640 --> 00:17:31,539
CEライブラリなんで

277
00:17:31,539 --> 00:17:33,480
Unchecked Center to付けます

278
00:17:33,480 --> 00:17:36,720
なのでこんなラッパーを用意します

279
00:17:36,720 --> 00:17:40,740
中にオープンエクスポインターを隠蔽しますと

280
00:17:40,740 --> 00:17:43,460
もちろん何しらセンダーブルーじゃなくてですね

281
00:17:43,460 --> 00:17:45,940
こういう風にロックをかけてあげます

282
00:17:45,940 --> 00:17:47,420
そしたら少なくとも

283
00:17:47,420 --> 00:17:49,660
こいつは安全ですと

284
00:17:49,660 --> 00:17:50,900
見えますか

285
00:17:50,900 --> 00:17:53,619
ピンポイントです

286
00:17:53,619 --> 00:17:55,380
データベースポイント

287
00:17:55,380 --> 00:17:57,359
の中にインペースしているので

288
00:17:57,359 --> 00:17:58,240
こういう風に

289
00:17:58,240 --> 00:18:01,039
スッキリな状態になりますし

290
00:18:01,039 --> 00:18:02,980
ちゃんとセンターブレードですよと

291
00:18:02,980 --> 00:18:05,519
CRUDの

292
00:18:05,519 --> 00:18:07,019
実装は今回は

293
00:18:07,019 --> 00:18:07,759
割愛します

294
00:18:07,759 --> 00:18:10,500
SU-Liteを

295
00:18:10,500 --> 00:18:12,180
加えまわしてですね

296
00:18:12,180 --> 00:18:15,319
適用した後はこういう風な構成になります

297
00:18:15,319 --> 00:18:16,259
できるでしょうみんな

298
00:18:16,259 --> 00:18:17,859
それだけなんで

299
00:18:17,859 --> 00:18:19,400
頑張っていきましょう

300
00:18:19,400 --> 00:18:25,299
冗談です サンプルコードになるので 見てくださいって感じなんですけど

301
00:18:25,299 --> 00:18:30,019
テストですね ちょっと話すんですけど

302
00:18:30,019 --> 00:18:36,200
まずCLIUDだけなので IO処理を実装するだけなので

303
00:18:36,200 --> 00:18:46,640
ここに着目するのは suite.curlizeというマクロを付けてるんですね

304
00:18:46,640 --> 00:18:49,859
なぜかというとファイルシステムを直接やるので

305
00:18:49,859 --> 00:18:52,299
Suite Testingはそもそも

306
00:18:52,299 --> 00:18:53,160
Devはですね

307
00:18:53,160 --> 00:18:55,779
AXEテストと違って

308
00:18:55,779 --> 00:18:58,960
正常系だけテストすればいいですと

309
00:18:58,960 --> 00:19:01,460
なのでテストケースでこれ走ると

310
00:19:01,460 --> 00:19:03,039
めちゃくちゃ恐怖するので

311
00:19:03,039 --> 00:19:04,779
ゴアシーラライズにしましょう

312
00:19:04,779 --> 00:19:06,140
ここはポイントですね

313
00:19:06,140 --> 00:19:07,579
はい

314
00:19:07,579 --> 00:19:11,119
データベースは以上です

315
00:19:11,119 --> 00:19:13,279
次はネットワーククラウドですね

316
00:19:13,279 --> 00:19:16,299
この図の右下の部分ですけど

317
00:19:16,299 --> 00:19:19,920
まず平行処理なんですよ

318
00:19:19,920 --> 00:19:20,759
全部コンカレント

319
00:19:20,759 --> 00:19:24,579
クライアント回しを直接ハードコードせずに

320
00:19:24,579 --> 00:19:27,240
こういう風にプロトコルを挟みます

321
00:19:27,240 --> 00:19:30,519
圧縮することはあるんじゃないですか

322
00:19:30,519 --> 00:19:35,700
なので5kBを一応仮にそう決めていて

323
00:19:35,700 --> 00:19:38,440
ボディを圧縮するように

324
00:19:38,440 --> 00:19:43,359
URLセッション運営のHTTPですね

325
00:19:43,359 --> 00:19:51,819
for networkingです リトライの待機時間を回すタックスリップ

326
00:19:51,819 --> 00:19:58,400
を取り扱うサスペンの関数もclosure として入れますと

327
00:19:58,400 --> 00:20:04,180
sendですね これが定数を定義します

328
00:20:04,180 --> 00:20:10,880
こういうふうにdebletのサイズに 入ったらヘッダーにエンコーディング

329
00:20:10,880 --> 00:20:17,119
を付けて圧縮しますそうでない 場合は普通に送信します

330
00:20:17,119 --> 00:20:23,000
後半はリトライの部分なんですけど リピードファイルを回してこういう

331
00:20:23,000 --> 00:20:27,960
風にプロトコルコンフォーマンス の本体の前半ですけど挟みつつ

332
00:20:27,960 --> 00:20:35,279
送信しますと 圧縮アルゴリズムはここではglib

333
00:20:35,279 --> 00:20:42,240
を使いますねサーバー次第なんですけど どういった圧縮アルゴリズムなん

334
00:20:42,240 --> 00:20:49,339
でもいいんで受け付ければいい と思いますしサスペンターを試したん

335
00:20:49,339 --> 00:20:55,680
ですけどうまくいかなかったんで 古き良きglibを使って実装しました

336
00:20:55,680 --> 00:21:01,960
とテストをちょっとします話します けどこういった風にこういう構成

337
00:21:01,960 --> 00:21:07,140
なんですね 全部Mockで収入できます なので待機秒数も全然拾えます

338
00:21:07,140 --> 00:21:11,380
ちなみにCompletion Planwork Apple更新 のやつなんですけど ネットワーキング

339
00:21:11,380 --> 00:21:17,079
を収入して こういった観測できます ね 最初の送信と3回リトライで

340
00:21:17,079 --> 00:21:22,779
合計4回送信っていうアサイズを かけられますし 秒数は248 2の

341
00:21:22,779 --> 00:21:29,640
炎上みたいな感じですね 拾えます ゆるいディスパッチャーなんですけど

342
00:21:29,640 --> 00:21:34,880
例えばこういう400エラーを回数 データストア ネットワーク&エラー

343
00:21:34,880 --> 00:21:40,700
ハンドラーみたいな作った部品 を入れて取り扱うように

344
00:21:40,700 --> 00:21:44,920
タスクですね ここだけバーが現れました

345
00:21:44,920 --> 00:21:50,140
アクターですね アクターでやるんですね

346
00:21:50,140 --> 00:21:58,200
プラスアルファでセキュリティー をオーバーライドします

347
00:21:58,200 --> 00:22:05,200
なぜそうしないといけないかというと、処理を単純にするためなんですよ。

348
00:22:05,200 --> 00:22:20,200
Actorってそもそも内部のバーのデータレースを、ここをExecutor内部の処理の順番とかはもう分からないですよね。

349
00:22:20,200 --> 00:22:38,680
なのでここはあえてシーラライズ化にして、そもそもこのドックシステムは単純な構成なので、別にそんなにコンカルエントを求めていないから、とりあえずシーラライズを回避してくれるんですけど、案内をしました。

350
00:22:38,680 --> 00:22:46,420
ダイジェストループなんですね。こういうふうに見覚えあると思うんですけど、ファイルループをタスクの中に入れて、シーラライズをしているだけですね。

351
00:22:47,359 --> 00:22:54,039
第一次党の本体なんで、ちなみにちょっとですね、イールドを最後に入れています。

352
00:22:54,039 --> 00:23:01,880
この関数はですね、そんな風にですね、ちょっとね、タスクツリーと思っていいですね。

353
00:23:01,880 --> 00:23:08,680
目的としては、他の優先順位の高いものに譲るんですよね、優先順位を。

354
00:23:08,680 --> 00:23:15,059
これは結構いい感じの構成なんで、こういう風にここにタスクイールドを入れましたと。

355
00:23:16,880 --> 00:23:23,880
時間未定の送信

356
00:23:23,880 --> 00:23:26,220
そして送信成功した削除

357
00:23:26,220 --> 00:23:28,000
という感じですね

358
00:23:28,000 --> 00:23:29,920
データの保存です

359
00:23:29,920 --> 00:23:33,440
何か大切な開始と終了

360
00:23:33,440 --> 00:23:35,420
の関数を用意します

361
00:23:35,420 --> 00:23:37,119
プロトコルをConfirmanceですね

362
00:23:37,119 --> 00:23:39,720
シリーズ化して送信

363
00:23:39,720 --> 00:23:41,599
JetTor本体なんですね

364
00:23:41,599 --> 00:23:43,759
ここは単純にデータを取り出して

365
00:23:43,759 --> 00:23:46,380
もちろん全部Mockにします

366
00:23:46,380 --> 00:23:49,700
例えばこんな感じなんですけども

367
00:23:49,700 --> 00:23:51,640
全部観測できますね

368
00:23:51,640 --> 00:23:55,339
なので適当に70件のログ入れますと

369
00:23:55,339 --> 00:23:57,779
6件入れて大手術を開始すると

370
00:23:57,779 --> 00:24:00,220
2回送信されました

371
00:24:00,220 --> 00:24:02,559
71件ね

372
00:24:02,559 --> 00:24:08,400
テストも次に大手術と並行処理ですね

373
00:24:08,400 --> 00:24:11,519
タスクグループのめちゃくちゃ大手術を開始してみて

374
00:24:11,519 --> 00:24:17,700
結局重複送信もせずにいい感じに配送されました

375
00:24:17,700 --> 00:24:20,420
トラッカーですね本体

376
00:24:20,420 --> 00:24:22,779
これはもう何もしなくていいんで

377
00:24:22,779 --> 00:24:26,779
部品を全部送信されているというダーサーシーンがかけられます

378
00:24:26,779 --> 00:24:29,299
使い方はこんな感じですね

379
00:24:29,299 --> 00:24:31,319
本体に本物を入れます

380
00:24:31,319 --> 00:24:33,839
タスクスリープをちゃんとここに入れて

381
00:24:33,839 --> 00:24:35,839
ネットワーキングも用意している瞬間とか

382
00:24:35,839 --> 00:24:37,980
隠蔽したラッパーを入れます

383
00:24:37,980 --> 00:24:41,019
テストカバー値はこういう風に

384
00:24:41,019 --> 00:24:43,359
小さいですけど82.6%です

385
00:24:43,359 --> 00:24:44,279
まあまあ高いです

386
00:24:44,279 --> 00:24:46,119
取り入れて

387
00:24:46,119 --> 00:24:49,220
何ようなインターフェースを用意すればいいです

388
00:24:49,220 --> 00:24:51,700
これで終わりなわけじゃないですよね

389
00:24:51,700 --> 00:24:53,400
移行作業に入ります

390
00:24:53,400 --> 00:24:55,700
例えばこんな

391
00:24:55,700 --> 00:25:00,000
現状はオールドログみたいなものがございますと

392
00:25:00,000 --> 00:25:03,259
ここから今作ったトラッカーに

393
00:25:03,259 --> 00:25:05,119
DRセントにしたいですと

394
00:25:05,119 --> 00:25:07,220
そしたらこういった

395
00:25:07,220 --> 00:25:10,339
ようやく基盤が完成しました

396
00:25:10,339 --> 00:25:14,559
このラッパーの中に2つ送信しますと

397
00:25:14,559 --> 00:25:17,440
残念ながらこれはできませんでした

398
00:25:17,440 --> 00:25:21,180
なぜかというとログはですね

399
00:25:21,180 --> 00:25:24,160
現実はそううまくいかないから

400
00:25:24,160 --> 00:25:29,099
このまま送信できるログはそもそも多くなかったんですね

401
00:25:29,099 --> 00:25:32,400
当たったパターンは考えられますね

402
00:25:32,400 --> 00:25:35,279
とりあえずこのアプローチを取ると

403
00:25:35,279 --> 00:25:38,339
大量なマッピング同時区がこうなります

404
00:25:38,339 --> 00:25:40,519
結構すごいことになるので

405
00:25:40,519 --> 00:25:44,660
性能もあんまり良くないので

406
00:25:44,660 --> 00:25:46,059
これはもう断念しますと

407
00:25:46,059 --> 00:25:49,740
じゃあどうしたいかというと

408
00:25:49,740 --> 00:25:50,900
根性でいきます

409
00:25:50,900 --> 00:25:54,660
そもそもAPIのインターフェースも紙はないし

410
00:25:54,660 --> 00:25:56,779
ログコールをですね

411
00:25:56,779 --> 00:25:59,160
あらかじめ全て洗い出して

412
00:25:59,160 --> 00:26:01,140
一個ずつ直していきます

413
00:26:01,140 --> 00:26:04,660
作業が膨大で普通に大変ですと

414
00:26:05,279 --> 00:26:15,059
全てダメじゃないですよね。正直ですね、性能は正直ピンポイントで直しているので、性能はそもそも根性でいけます。

415
00:26:15,059 --> 00:26:25,400
全てとりあえずですね、この毒何?みたいなことを議論しつつね、いらないものを消していきます。

416
00:26:25,400 --> 00:26:27,839
リファクタリングというわけですよね。

417
00:26:29,839 --> 00:26:32,500
やるにはこういうタイミングなんですよ

418
00:26:32,500 --> 00:26:34,440
出ないといつまでもいい

419
00:26:34,440 --> 00:26:36,299
引くときにいいですと

420
00:26:36,299 --> 00:26:39,180
せっかく見直したので

421
00:26:39,180 --> 00:26:41,240
実際にやったことは

422
00:26:41,240 --> 00:26:42,599
例えばこんなログ

423
00:26:42,599 --> 00:26:45,200
タップとしてサンプルにしてるんですけど

424
00:26:45,200 --> 00:26:47,740
オールドタップイベントログがあります

425
00:26:47,740 --> 00:26:51,500
トラッカーにも新しいタップイベントを提起していますと

426
00:26:51,500 --> 00:26:55,119
これそれぞれ基盤にAPMをしてる

427
00:26:55,119 --> 00:26:57,200
できないから

428
00:26:57,200 --> 00:27:00,480
モチーフとして取っていきますと

429
00:27:00,480 --> 00:27:02,740
こういう風にですね

430
00:27:02,740 --> 00:27:04,839
新しい方につないでいきますと

431
00:27:04,839 --> 00:27:05,039
はい

432
00:27:05,039 --> 00:27:08,039
こういう風につないでいきますね

433
00:27:08,039 --> 00:27:08,319
こう

434
00:27:08,319 --> 00:27:12,400
セルフを返してるんですよ

435
00:27:12,400 --> 00:27:14,920
なのでフルエンドインターフェースになりますね

436
00:27:14,920 --> 00:27:16,200
こういう風に

437
00:27:16,200 --> 00:27:19,400
こういう風につないでいけば

438
00:27:19,400 --> 00:27:20,759
オールドの方ですね

439
00:27:20,759 --> 00:27:22,859
古い方にメソッドを増やします

440
00:27:22,859 --> 00:27:24,259
やりやすいまず

441
00:27:24,259 --> 00:27:26,940
こう書いてあるので

442
00:27:26,940 --> 00:27:30,019
目視で分かるこれまでより線と対応済みですと

443
00:27:30,019 --> 00:27:33,599
なので特に手動修正いらない

444
00:27:33,599 --> 00:27:35,880
ログに関してはこういう風に

445
00:27:35,880 --> 00:27:38,420
いい感じのメソッドを挟めばいい

446
00:27:38,420 --> 00:27:39,880
という感じになります

447
00:27:39,880 --> 00:27:41,519
あれですね

448
00:27:41,519 --> 00:27:45,200
Fluent in my faceなんで

449
00:27:45,200 --> 00:27:47,700
並べて個別実装にします

450
00:27:47,700 --> 00:27:51,319
例えばこの例なんですけど

451
00:27:51,319 --> 00:27:53,400
キーを変えましたね

452
00:27:53,400 --> 00:27:55,700
item.itをnew item.itに変えました

453
00:27:55,700 --> 00:28:01,279
実際私がやった作業ではこんな単純な作業だけじゃないのでいっぱいありました

454
00:28:01,279 --> 00:28:06,819
個別修正が必要な箇所はこういう風に

455
00:28:06,819 --> 00:28:09,519
ですけど普通に大変だったんですよ

456
00:28:09,519 --> 00:28:17,019
もう作業の途中から自分一体何やってるんだろうみたいな

457
00:28:17,019 --> 00:28:21,220
私はなんでここにいるんだという人生を疑いましたね

458
00:28:21,220 --> 00:28:26,299
という孤独がいくつかあって何か頑張りました

459
00:28:26,299 --> 00:28:32,000
結果なんでそういう気持ちを抱えつつもですね

460
00:28:32,000 --> 00:28:38,160
この毒一体何やみたいな議論を繰り返してですね

461
00:28:38,160 --> 00:28:41,039
結果的にペイロードサイズをまあまあ削減できましたと

462
00:28:41,039 --> 00:28:43,480
共通パラメータもですねいっぱいあったんですけど

463
00:28:43,480 --> 00:28:45,700
いらないよねって決めたらもう

464
00:28:45,700 --> 00:28:48,039
本当に作業量が非常に膨大でした

465
00:28:48,039 --> 00:28:52,640
データ量を減らせましたと

466
00:28:52,640 --> 00:28:54,299
古いシステムもこのまま

467
00:28:54,299 --> 00:28:56,059
マス抜きなんですけどね

468
00:28:56,059 --> 00:28:57,799
これで

469
00:28:57,799 --> 00:29:00,539
移行作業の話でした

470
00:29:00,539 --> 00:29:04,039
次にですね

471
00:29:04,039 --> 00:29:07,440
物を作ったのでリリースしないといけないし

472
00:29:07,440 --> 00:29:09,920
新しいシステムは

473
00:29:09,920 --> 00:29:11,079
我々

474
00:29:11,079 --> 00:29:14,220
理由の話はしたけど

475
00:29:14,220 --> 00:29:16,740
メリットいっぱいありますね

476
00:29:16,740 --> 00:29:18,880
みんなある程度やってると思うんですけど

477
00:29:18,880 --> 00:29:22,200
キャラリアリリースみたいなやり方で

478
00:29:22,200 --> 00:29:23,839
メリットいっぱいありますと

479
00:29:23,839 --> 00:29:26,720
問題が発見しましたら

480
00:29:26,720 --> 00:29:28,019
すぐに止めてですね

481
00:29:28,019 --> 00:29:29,480
自決可能です

482
00:29:29,480 --> 00:29:31,480
リリース計画になりますと

483
00:29:31,480 --> 00:29:35,180
段階的な移行につながって

484
00:29:35,180 --> 00:29:36,819
フォトフィックス出さなきゃいけない

485
00:29:36,819 --> 00:29:38,099
ためになったらですね

486
00:29:38,099 --> 00:29:40,539
だいぶすごい大変な作業になります

487
00:29:40,539 --> 00:29:42,539
いっぱい人が動く行動になります

488
00:29:42,539 --> 00:29:46,099
なのでこういう大規模な移行については

489
00:29:46,099 --> 00:29:49,579
とりあえず単外的に行こうかお勧めですね

490
00:29:49,579 --> 00:29:51,000
制御可能にします

491
00:29:51,000 --> 00:29:53,940
メリットいっぱいあるんですけど

492
00:29:53,940 --> 00:29:56,660
大きな事故については

493
00:29:56,660 --> 00:29:58,839
徐々に開放していくので

494
00:29:58,839 --> 00:30:00,559
こんな感じで

495
00:30:00,559 --> 00:30:02,960
すでにいっぱい一気にリリースしちゃうと

496
00:30:02,960 --> 00:30:03,900
新しいシステム

497
00:30:03,900 --> 00:30:05,599
サーバー担当も

498
00:30:05,599 --> 00:30:07,519
サーバー耐えられるか分からないか

499
00:30:07,519 --> 00:30:08,839
とかあるので

500
00:30:08,839 --> 00:30:11,599
本当にこれが必要ですと

501
00:30:11,599 --> 00:30:13,119
ちなみになんですけど

502
00:30:13,119 --> 00:30:17,839
サーバー復活の分散に関しても

503
00:30:17,839 --> 00:30:21,039
そういう側面に対しても何かしらの対策が必要なんです

504
00:30:21,039 --> 00:30:23,099
なぜかというと

505
00:30:23,099 --> 00:30:26,660
強制アップデートを行わないとですね

506
00:30:26,660 --> 00:30:32,440
ずっと古いアプリを使い続けるユーザーはですね

507
00:30:32,440 --> 00:30:34,779
ずっと古いシステムに

508
00:30:34,779 --> 00:30:36,440
まだ覚えていますか皆さん

509
00:30:36,440 --> 00:30:39,059
強制アップデートは行わないです

510
00:30:39,059 --> 00:30:42,059
なのでこれによって送信活動を続けてしまいます

511
00:30:42,059 --> 00:30:45,240
さっき話した通りサーバーなくなりますよ

512
00:30:45,240 --> 00:30:50,099
なんで404存在しないサーバーにずっとデータを送る羽目になります

513
00:30:50,099 --> 00:30:54,319
なのでそもそも強制アップデートをなぜ送らないと

514
00:30:54,319 --> 00:30:58,440
純粋にユーザーのデータをどこに送っちゃうんですよね

515
00:30:58,440 --> 00:31:01,119
なので強制アップデートをしてあげないと

516
00:31:01,119 --> 00:31:06,680
そうした間を取る手段を考えなければならないですね

517
00:31:06,680 --> 00:31:11,519
なんで話した通りアップデートをしたいユーザーは

518
00:31:11,519 --> 00:31:14,579
旧システムに送信し続けてしまう

519
00:31:14,579 --> 00:31:17,440
コスト削減とかも話します

520
00:31:17,440 --> 00:31:19,440
ハードル差分とか

521
00:31:19,440 --> 00:31:22,420
UXに関する懸念があるわけで

522
00:31:22,420 --> 00:31:23,759
なるべくしないように

523
00:31:23,759 --> 00:31:25,059
制御が必要ですね

524
00:31:25,059 --> 00:31:27,099
旧システムに対しては

525
00:31:27,099 --> 00:31:30,539
ログを遮断するフラグを用意します

526
00:31:30,539 --> 00:31:32,579
新しいシステムに対しては

527
00:31:32,579 --> 00:31:34,059
段階的にロールアウトなので

528
00:31:34,059 --> 00:31:36,980
それもフラグを用意して

529
00:31:36,980 --> 00:31:39,400
ユーザーの割合に対して

530
00:31:39,400 --> 00:31:41,279
上陣上陣変えようと思うんですけど

531
00:31:41,279 --> 00:31:44,180
なのでこういう風に

532
00:31:44,180 --> 00:31:45,480
2パターンの

533
00:31:45,480 --> 00:31:48,599
遮断制御はデフはツルーで

534
00:31:48,599 --> 00:31:49,619
全開放します

535
00:31:49,619 --> 00:31:51,380
ハードコード

536
00:31:51,380 --> 00:31:54,259
例えばプラグが存在しない場合

537
00:31:54,259 --> 00:31:56,920
コード上ハードコードする値を

538
00:31:56,920 --> 00:31:58,200
フォルスにします

539
00:31:58,200 --> 00:32:00,799
逆ドローの方は

540
00:32:00,799 --> 00:32:01,559
逆ですね

541
00:32:01,559 --> 00:32:03,119
フォルスが起こしていきます

542
00:32:03,119 --> 00:32:06,299
ここに着目するのは

543
00:32:06,299 --> 00:32:09,099
不適な状態にします

544
00:32:09,099 --> 00:32:14,519
なのでフラッグはFirebase上から最終的に消せます

545
00:32:14,519 --> 00:32:22,420
消したら最終的な状態に動くので

546
00:32:22,420 --> 00:32:25,880
こういった設定になりますからスルーに変えます

547
00:32:25,880 --> 00:32:29,079
いずれもデフォルトの値は

548
00:32:29,079 --> 00:32:35,140
最終2024年10月にもうすでに遮断の制御を事前にリリースしました

549
00:32:35,140 --> 00:32:47,880
なので結構1年前ぐらいこのツールの値がほぼ全ユーザーに時間で持ちますね

550
00:32:47,880 --> 00:32:50,000
実績になりますけど

551
00:32:50,000 --> 00:32:56,819
実装も1ヶ月を挟んで制御実装を入れました

552
00:32:56,819 --> 00:33:03,380
なので旧システムに対しては何も起きませんでしたみたいな感じになります

553
00:33:03,380 --> 00:33:06,140
もちろんもうフラグ仕込んでいるので

554
00:33:06,140 --> 00:33:09,079
後でフラグをかけてですね

555
00:33:09,079 --> 00:33:13,059
フラグが振動するように事前にリリースしますと

556
00:33:13,059 --> 00:33:16,680
制御時に強制アップデートせずに済むんですと

557
00:33:16,680 --> 00:33:20,740
新しいシステムの実績はこうなりますけど

558
00:33:20,740 --> 00:33:26,119
これはね今年1月にもフラグをフォルスにして100%公開しました

559
00:33:26,119 --> 00:33:31,079
4月にですね全部変えればね

560
00:33:31,079 --> 00:33:33,299
旧システムの送信も全部なくなります

561
00:33:33,299 --> 00:33:34,660
という感じですね

562
00:33:34,660 --> 00:33:38,940
それで4月の10日あたりですね

563
00:33:38,940 --> 00:33:40,039
リリースにしましたと

564
00:33:40,039 --> 00:33:42,680
カレンダーバージョニングは

565
00:33:42,680 --> 00:33:43,640
うち採用しているので

566
00:33:43,640 --> 00:33:45,859
リリース時期はここら辺ですと

567
00:33:45,859 --> 00:33:48,000
分かりやすいです

568
00:33:48,000 --> 00:33:50,119
5段階に分けてですね

569
00:33:50,119 --> 00:33:53,039
こういう風にリリース機能に

570
00:33:53,039 --> 00:33:54,039
なんていうか

571
00:33:54,039 --> 00:33:57,380
新しいシステムの6実装全部一括で

572
00:33:57,380 --> 00:33:59,559
一時的にゼロパーにしました

573
00:33:59,559 --> 00:34:02,200
それをなんとか直してですね

574
00:34:02,200 --> 00:34:06,000
問題なかったので50%までスキルして

575
00:34:06,000 --> 00:34:09,460
この後スケジュールという実績になります

576
00:34:09,460 --> 00:34:11,300
結果ですね

577
00:34:11,300 --> 00:34:12,860
ホットフィックスはなかったし

578
00:34:12,860 --> 00:34:16,559
4月上旬にですね

579
00:34:16,559 --> 00:34:18,280
削減ちょっとね

580
00:34:18,280 --> 00:34:19,840
副は観測してですね

581
00:34:19,840 --> 00:34:22,219
安心することは非常に大事ですよね

582
00:34:22,219 --> 00:34:24,659
焦ることは本当に大変なので

583
00:34:24,659 --> 00:34:30,760
本当に音品な集団でリリースすることはお勧めします

584
00:34:30,760 --> 00:34:36,960
フラグの制御とかも結構めちゃくちゃ良かったです

585
00:34:36,960 --> 00:34:39,780
物理的安定性もいいし

586
00:34:39,780 --> 00:34:42,579
心理的安定性も特に決めたので

587
00:34:42,579 --> 00:34:44,980
こういうふうにですね

588
00:34:44,980 --> 00:34:49,320
残りなくフラグを永遠に消せないよみたいな状態を作らない

589
00:34:49,320 --> 00:34:52,159
強制アベイドももちろんしなかったんです

590
00:34:52,159 --> 00:34:57,159
今はですねまたデュアルセンドの期間中なので

591
00:34:57,800 --> 00:35:02,639
計画の段階でこういうふうにツルフォルス運営の話をします

592
00:35:02,639 --> 00:35:07,320
アフターリリースはその後はモニタリングして

593
00:35:07,320 --> 00:35:09,079
クラシアがあったら修正します

594
00:35:09,079 --> 00:35:11,900
原因調査で修正するなり

595
00:35:11,900 --> 00:35:13,280
あとはまだやってないですけど

596
00:35:13,280 --> 00:35:14,800
制御フラッグの削除とか

597
00:35:14,800 --> 00:35:16,780
急実装の削除とか

598
00:35:16,780 --> 00:35:19,219
そういったタスクを残ったりする

599
00:35:19,219 --> 00:35:23,360
なのであと少しです

600
00:35:23,360 --> 00:35:26,199
実は全部消します

601
00:35:26,199 --> 00:35:32,539
一気に2000行の赤い数字の差分を出したいですね

602
00:35:32,539 --> 00:35:36,400
まだですけど期待したいです

603
00:35:36,400 --> 00:35:39,860
というわけでゴールまであと少しでございます

604
00:35:39,860 --> 00:35:46,179
これがエンジニアとしては一番ワクワクなフェースなんですけど

605
00:35:46,179 --> 00:35:51,179
いらないと何とコードログって何とかの話をしました

606
00:35:51,179 --> 00:35:58,260
DigestDubという結構最初に考えたコアのロジックから

607
00:35:58,260 --> 00:36:01,639
インターフェース設計とかアーキテクチャの話に展開しました

608
00:36:01,639 --> 00:36:04,980
まとめに入ります

609
00:36:04,980 --> 00:36:07,000
まずですね

610
00:36:07,000 --> 00:36:10,800
ログシステムそもそもいただきましたと

611
00:36:10,800 --> 00:36:12,800
テストコードですね

612
00:36:12,800 --> 00:36:15,420
ピンポイントで紹介しましたけど

613
00:36:15,420 --> 00:36:20,639
フルなソースコードはサンプルエポジトにあるので見てください

614
00:36:20,639 --> 00:36:23,960
もちろんですねここは自社製なんですよ

615
00:36:23,960 --> 00:36:26,940
基本的にもちろんクリーンソリッドの構成になっています

616
00:36:26,940 --> 00:36:30,800
スイブットシックスに基づいた実装で紹介させて

617
00:36:30,800 --> 00:36:33,820
話は外部の人とかに頼らずにですね

618
00:36:33,820 --> 00:36:36,400
実車で解決します

619
00:36:36,400 --> 00:36:38,800
これが内製化のメリットなんですけどね

620
00:36:38,800 --> 00:36:41,920
その皮に私が大変なんですけど

621
00:36:41,920 --> 00:36:44,199
冗談です

622
00:36:44,199 --> 00:36:46,360
我々は基盤作りは今日も楽しいですよ

623
00:36:46,360 --> 00:36:48,000
全て私が作りましたので

624
00:36:48,000 --> 00:36:50,960
これから機能の拡張とか

625
00:36:50,960 --> 00:36:52,619
何かつけたいとか

626
00:36:52,619 --> 00:36:54,260
まとめその2ですけど

627
00:36:54,260 --> 00:36:56,940
Eコースアギュラーアプローチを紹介しました

628
00:36:56,940 --> 00:37:02,360
エレガントのアタウターパターンもあるんですけれども

629
00:37:02,360 --> 00:37:06,099
現実はそううまくいかないんですよね

630
00:37:06,099 --> 00:37:07,519
普通はそう

631
00:37:07,519 --> 00:37:10,719
皆さんぜひそのチャンスあればやってみてください

632
00:37:10,719 --> 00:37:12,860
全然怖くないです

633
00:37:12,860 --> 00:37:16,079
食いしばって根性でいきます

634
00:37:16,079 --> 00:37:18,260
ぜひ根性でいきましょう

635
00:37:18,260 --> 00:37:20,619
根性でいきました

636
00:37:20,619 --> 00:37:23,300
結局良かったんですね

637
00:37:23,300 --> 00:37:26,559
リパークリングもできましたし

638
00:37:26,559 --> 00:37:27,940
いい感じでしたと

639
00:37:27,940 --> 00:37:29,699
ヘルパーメソッドとか

640
00:37:29,699 --> 00:37:31,739
理想はあくまで理想

641
00:37:31,739 --> 00:37:33,559
っていうことなんですけど

642
00:37:33,559 --> 00:37:34,800
なので基本的には

643
00:37:34,800 --> 00:37:37,420
ハーフなんですね

644
00:37:37,420 --> 00:37:39,739
要点としては

645
00:37:39,739 --> 00:37:41,519
旧システムに対しては

646
00:37:41,519 --> 00:37:43,179
フォローを設定してから

647
00:37:43,179 --> 00:37:44,239
ツールに変えます

648
00:37:44,239 --> 00:37:45,900
逆だった

649
00:37:45,900 --> 00:37:49,199
trueに設定しからfalseに変えます

650
00:37:49,199 --> 00:37:51,820
新しいシステムのドルアウトに対しては

651
00:37:51,820 --> 00:37:53,900
具体的な手段を紹介しました

652
00:37:53,900 --> 00:37:55,940
ソースコードを介してですね

653
00:37:55,940 --> 00:37:57,760
まとめその3ですけど

654
00:37:57,760 --> 00:37:59,480
ここは簡単構成になりますので

655
00:37:59,480 --> 00:38:02,280
こういったアレンジがいいと思います

656
00:38:02,280 --> 00:38:05,679
強制アップデートをせずにするんですね

657
00:38:05,679 --> 00:38:08,599
参考になればと思いますけれども

658
00:38:08,599 --> 00:38:10,360
5段階はうち

659
00:38:10,360 --> 00:38:12,739
今回ドルアウトは5段階分けたんですけど

660
00:38:12,739 --> 00:38:15,760
VoltsからTrueに変えます

661
00:38:15,760 --> 00:38:19,699
Configは消せるように

662
00:38:19,699 --> 00:38:23,380
基本なログ基盤を作った感じなんですけど

663
00:38:23,380 --> 00:38:25,760
やることはまだいっぱいあるんですよね

664
00:38:25,760 --> 00:38:28,699
CPUの使用率とかメモリに合わせてですね

665
00:38:28,699 --> 00:38:30,559
ソーセンペースを調整するなり

666
00:38:30,559 --> 00:38:32,440
そういった工夫は考えられます

667
00:38:32,440 --> 00:38:34,860
ゲームアプリとかリアルタイムアプリみたいな

668
00:38:34,860 --> 00:38:36,579
結構ねパフォーマンス高く分けていいので

669
00:38:36,579 --> 00:38:38,360
ここはもうお好きなように

670
00:38:38,360 --> 00:38:40,980
おまけなんですけど

671
00:38:40,980 --> 00:38:43,059
結構気にもいますし

672
00:38:43,059 --> 00:38:47,340
そもそもディスク容量が結構まずいユーザーはね

673
00:38:47,340 --> 00:38:50,659
そもそもデータベースは開けられないというパターンがあるので

674
00:38:50,659 --> 00:38:52,139
そこはですね

675
00:38:52,139 --> 00:38:55,340
インメモリデータストアとかにフォールバックしてですね

676
00:38:55,340 --> 00:38:57,440
そういうふうにですね

677
00:38:57,440 --> 00:38:59,840
本当に厳しいアプリに関しては

678
00:38:59,840 --> 00:39:04,639
独自システムはここら辺のファクターを考慮してもいいと思いますので

679
00:39:04,639 --> 00:39:06,340
こういった手段を見ますね

680
00:39:06,340 --> 00:39:08,559
オフタン環境ではですね

681
00:39:08,559 --> 00:39:13,000
例えば飛行機にいる中で送信できないから

682
00:39:13,000 --> 00:39:15,699
リーチアビリティを監視してですね

683
00:39:15,699 --> 00:39:17,239
配送の送信しないように

684
00:39:17,239 --> 00:39:23,139
Wi-Fiが入ったら基盤の挙動を変えずに

685
00:39:23,139 --> 00:39:26,380
依存させ替えれば今もいないですけど

686
00:39:26,380 --> 00:39:28,420
繰り返しになりますが

687
00:39:28,420 --> 00:39:31,619
デファレンス、ソース、リボットとですね

688
00:39:31,619 --> 00:39:33,360
サンプルコードこちらにあります

689
00:39:33,360 --> 00:39:34,440
ぜひご覧ください

690
00:39:34,440 --> 00:39:36,920
ちょっとした宣伝なんですが

691
00:39:36,920 --> 00:39:38,340
アフターイベントをやります

692
00:39:38,340 --> 00:39:43,059
ここはですねちょっとした前提をめちゃくちゃ送信していきますと

693
00:39:43,059 --> 00:39:45,840
そういった工夫は考えられます

694
00:39:45,840 --> 00:39:47,940
以上となります

695
00:39:47,940 --> 00:39:51,280
時間は来月10月17日

696
00:39:51,280 --> 00:39:53,480
まだちょっと先なんですが19時ですね

697
00:39:53,480 --> 00:39:59,079
場所はうちのオフィス六本木東京ミッドタウン11階になります

698
00:39:59,079 --> 00:40:02,940
ライコンバースページはここにあるのでぜひいらして

699
00:40:02,940 --> 00:40:04,480
ラインマンガの裏話とか

700
00:40:04,480 --> 00:40:06,440
E-BOOKS JAPANとかの裏話を

701
00:40:06,440 --> 00:40:08,539
話す予定だと思います

702
00:40:08,539 --> 00:40:12,000
開発のすべてを

703
00:40:12,000 --> 00:40:14,320
話しさせていただきました

704
00:40:14,320 --> 00:40:16,860
ご清聴ありがとうございました

705
00:40:16,860 --> 00:40:27,059
おいしいご飯を用意しております

706
00:40:27,059 --> 00:40:28,440
以上

707
00:40:28,440 --> 00:40:30,039
ラインマンガを支える

708
00:40:30,039 --> 00:40:31,659
独機版の設計

709
00:40:31,659 --> 00:40:34,179
質問のある方は手を挙げてお知らせください

710
00:40:34,179 --> 00:40:40,099
お願いいたします

711
00:40:40,099 --> 00:40:41,139
マイクお持ちします

712
00:40:41,139 --> 00:40:42,940
ありがとうございました

713
00:40:42,940 --> 00:40:46,659
結構行動がクリーンアーキテクト

714
00:40:46,659 --> 00:40:49,119
発表ありがとうございました

715
00:40:49,119 --> 00:40:52,340
それではQ&Aに入りたいと思います

716
00:40:52,340 --> 00:40:55,940
コメントや質問を書くと理解も深まるというか

717
00:40:55,940 --> 00:40:58,380
僕は割とプロダクトファイアベースを使っているし

718
00:40:58,380 --> 00:41:01,519
送ってしまってその辺の理解も勉強できるといいなというのは

719
00:41:01,519 --> 00:41:02,420
自分でも思いました

720
00:41:02,420 --> 00:41:04,920
これは最終的にリリースする前に

721
00:41:04,920 --> 00:41:06,519
開発期間とか

722
00:41:06,519 --> 00:41:08,739
人数はどのくらいで開発しないと

723
00:41:08,739 --> 00:41:10,179
きれいですし

724
00:41:10,179 --> 00:41:12,739
テストもしやすい構図になっているのが

725
00:41:12,739 --> 00:41:14,300
すごくいいなって思いましたし

726
00:41:14,300 --> 00:41:15,559
そこをやっぱり自分で

727
00:41:15,559 --> 00:41:18,119
開発は私一人です

728
00:41:18,119 --> 00:41:19,320
なので

729
00:41:19,320 --> 00:41:22,219
レバランスめちゃ少ないじゃないですか

730
00:41:22,219 --> 00:41:22,760
Gboot

731
00:41:22,760 --> 00:41:24,659
コンプレッションプレミアムしかない

732
00:41:24,659 --> 00:41:26,539
全部私が考えました

733
00:41:26,539 --> 00:41:28,559
すごい

734
00:41:28,559 --> 00:41:32,739
最終的な今のリリースまでに

735
00:41:32,739 --> 00:41:34,679
こぎつけたって感じだったんでしょうか

736
00:41:34,679 --> 00:41:36,840
言っていいですかそもそも

737
00:41:36,840 --> 00:41:38,260
こういう風にですね

738
00:41:38,260 --> 00:41:39,619
1000万ダウンロード

739
00:41:39,619 --> 00:41:41,360
という規模の

740
00:41:41,360 --> 00:41:43,139
ノグ基盤はこれでいきましたので

741
00:41:43,139 --> 00:41:44,900
ぜひ参考にしてみてください

742
00:41:44,900 --> 00:41:46,119
開発期間はですね

743
00:41:46,119 --> 00:41:48,079
1年以上かかりましたね

744
00:41:48,079 --> 00:41:50,559
そもそも作業は非常に多かったんで

745
00:41:50,559 --> 00:41:52,820
あと作業にはですね

746
00:41:52,820 --> 00:41:54,739
根拠のない自信が必要なんですよ

747
00:41:54,739 --> 00:41:56,599
ってないと何も始まらないので

748
00:41:56,599 --> 00:42:02,099
結果オーライでしたら コンサート半ぐらいかな わかんないですけど

749
00:42:02,099 --> 00:42:05,300
AIとかも結構活用 根性ってあったんですけど

750
00:42:05,300 --> 00:42:10,099
ある程度AIとかを活用して 天ぷらのところは直すみたいなのできるのかなとか思ったんですけど

751
00:42:10,099 --> 00:42:11,099
やっぱりそれは難しいですか

752
00:42:11,099 --> 00:42:18,099
今年からの仕事は悪かしじゃない やり取り運もいっぱいありましたので

753
00:42:18,099 --> 00:42:24,099
そういった感じで大体1年ちょっと投入があれですけど

754
00:42:24,099 --> 00:42:27,380
考案してちょっと考えました

755
00:42:27,380 --> 00:42:29,179
ちなみにこういったコースはですね

756
00:42:29,179 --> 00:42:33,480
他の方とか知見のある方とも話してましたので

757
00:42:33,480 --> 00:42:35,480
こんなコースでまず行きます

758
00:42:35,480 --> 00:42:37,099
AI導入してるんですけど

759
00:42:37,099 --> 00:42:38,739
これはですね去年やったので

760
00:42:38,739 --> 00:42:42,519
特にAIツール使ってなかったんですね

761
00:42:42,519 --> 00:42:43,159
お知事は

762
00:42:43,159 --> 00:42:46,079
ご質問のある方ありましたら挙手をお願いいたします

763
00:42:46,079 --> 00:42:49,460
マイクお持ちいたしますので少々お待ちください

764
00:42:54,099 --> 00:42:58,199
聞けそう

765
00:42:58,199 --> 00:43:00,039
ガチ根性であったところです

766
00:43:00,039 --> 00:43:01,159
ありがとうございます

767
00:43:01,159 --> 00:43:03,639
ありがとうございました

768
00:43:03,639 --> 00:43:05,139
他にコメントや

769
00:43:05,139 --> 00:43:10,400
人生を疑うとか根性が大切とかっていう話はすごい共感できました

770
00:43:10,400 --> 00:43:13,400
ちょっと質問なんですけど

771
00:43:13,400 --> 00:43:15,619
要件のところに書いてあった

772
00:43:15,619 --> 00:43:19,599
ログ送信の時のメモリーショー

773
00:43:19,599 --> 00:43:21,840
面白い発表ありがとうございました

774
00:43:21,840 --> 00:43:29,519
自分もちょっとユーザーコードログのライブラリを社内で開発しているのでやってたのかが気になりまして

775
00:43:29,519 --> 00:43:38,860
その辺自分たちでテストのアプリを作ってそのライブラリを導入してベンチマークを新旧で取るのか

776
00:43:38,860 --> 00:43:46,119
あるいはそのサービスのアプリにある日とか電力消費とかの要件に入ってたと思うんですけど

777
00:43:46,119 --> 00:43:48,739
そこら辺の検証をどういうふうに

778
00:43:48,739 --> 00:43:54,239
ベンチマークはですね、正直やっていませんでした。

779
00:43:54,239 --> 00:43:59,239
スケジュールの都合上とかもありますし、

780
00:43:59,239 --> 00:44:03,239
そもそもこの構成はもうだいぶミニアムの

781
00:44:03,239 --> 00:44:07,239
どれ程度組み込んでやってもらったりしたのかっていうのをお聞きしたいです。

782
00:44:07,239 --> 00:44:11,239
はい、そこら辺ですね、一応考えてはいます。

783
00:44:11,239 --> 00:44:13,239
みたいなアプローチをとります。

784
00:44:13,239 --> 00:44:15,239
まずリリースしてからアートを考えます。

785
00:44:15,239 --> 00:44:17,239
みたいなアプローチをとります。

786
00:44:17,239 --> 00:44:36,460
そしてですね、普通にエスコートのインストゥルメントは自分で見てるんですけど、特に問題なかったので、とりあえずリースしてみましょうという構成になっているので、まず問題起きたらね、まず止めてですね、みんなちょっと答えていけなくたという感じです。申し訳ございません。

787
00:44:36,460 --> 00:44:38,480
いいえ、大丈夫です。ありがとうございます。

788
00:44:38,480 --> 00:44:41,059
ありがとうございました。

789
00:44:41,059 --> 00:44:46,960
お時間的に次が最後になりそうです。コメントやご質問の方は挙手をお願いいたします。

790
00:44:47,000 --> 00:44:47,980
アプローチを取りました

791
00:44:47,980 --> 00:44:49,820
ベンジマークはですね

792
00:44:49,820 --> 00:44:52,980
私ちょっとあんまり

793
00:44:52,980 --> 00:44:54,280
慣れていなかったので

794
00:44:54,280 --> 00:44:54,639
そこは

795
00:44:54,639 --> 00:45:00,780
次回になりましたので

796
00:45:00,780 --> 00:45:03,659
これでQ&Aを終了させていただきます

797
00:45:03,659 --> 00:45:05,460
続いて1分間フィードバックの

798
00:45:05,460 --> 00:45:06,940
お時間です

799
00:45:06,940 --> 00:45:16,579
他にいらっしゃいますか

800
00:45:17,000 --> 00:45:33,599
1分間フィードバックのお時間です

801
00:45:33,599 --> 00:45:36,900
スクリーンのQRコードを読み取って

802
00:45:36,900 --> 00:45:38,480
フィードバックを送って

803
00:45:47,000 --> 00:46:08,739
この後4階展示ルーム前でパスクラスピーカーを実施します

804
00:46:08,739 --> 00:46:12,400
質問がある方や感想を伝えたい方はぜひご参加ください

805
00:46:17,000 --> 00:46:40,639
それではデスクスさんありがとうございました

806
00:46:47,000 --> 00:47:06,099
おやすみなさい

