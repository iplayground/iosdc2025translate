1
00:00:02,950 --> 00:00:06,960
QRコードの仕様ってN種類アンネン

2
00:00:06,960 --> 00:00:09,460
Nは何か分かりますか

3
00:00:09,460 --> 00:00:13,539
ぜひiOSDC #Dでツイートしてくださいね

4
00:00:13,539 --> 00:00:14,480
はい

5
00:00:14,480 --> 00:00:15,380
りょむです

6
00:00:15,380 --> 00:00:16,739
よろしくお願いします

7
00:00:16,739 --> 00:00:19,260
iOSアプリエンジニアをしていて

8
00:00:19,260 --> 00:00:26,160
仕事では電車とかバスの交通チケットを主に取り扱うようなマースアプリを開発しています

9
00:00:26,160 --> 00:00:30,480
さて、QRコードを生成したい

10
00:00:30,480 --> 00:00:37,780
QRコードの生成には CIFilterのCIQRCodeGeneratorを使います

11
00:00:37,780 --> 00:00:42,380
inputMessageにQRコードに含めるデータ

12
00:00:42,380 --> 00:00:46,619
inputCorrectionLevelに誤り訂正レベルが指定できます

13
00:00:46,619 --> 00:00:49,320
誤り訂正レベルというのは

14
00:00:49,320 --> 00:00:52,420
どの程度汚れたり隠れたりしても

15
00:00:52,420 --> 00:00:55,359
読み取れるようにするのかというレベルです

16
00:00:55,359 --> 00:00:57,659
大きさなんかをちょっと整えて

17
00:00:57,659 --> 00:01:00,420
QRコードが生成できました

18
00:01:00,420 --> 00:01:02,500
いやめでたしめでたし

19
00:01:02,500 --> 00:01:05,200
それだとよかったですね

20
00:01:05,200 --> 00:01:11,719
最近のマース界隈ではQRチケットが今大流行中です

21
00:01:11,719 --> 00:01:17,099
改札機のような大掛かりな設備がなくても簡単に導入することができます

22
00:01:17,099 --> 00:01:19,859
ただこのQRチケット

23
00:01:19,859 --> 00:01:22,920
QRコードを読み込む端末によっては

24
00:01:22,920 --> 00:01:26,180
QRの仕様が厳密に定められているときがあって

25
00:01:26,180 --> 00:01:30,340
仕様が満たせないと読み込んでもらえないということが起こり得ます

26
00:01:30,340 --> 00:01:36,019
そのうちの一つにバージョンと呼ばれる仕様があります

27
00:01:36,019 --> 00:01:41,680
QRコードの最小のマス目をセルと呼ぶんですけれども

28
00:01:41,680 --> 00:01:47,040
このセルが縦横に何個あるかという定義がバージョンで表されています

29
00:01:47,040 --> 00:01:52,040
バージョンによってはQRコードに含められるデータ量が変わります

30
00:01:52,040 --> 00:01:55,959
バージョンは1から40まであり

31
00:01:55,959 --> 00:01:59,620
バージョンが大きくなるとその分セルの数も増えるので

32
00:01:59,620 --> 00:02:03,980
つまりそのままQRコードに含められるデータ量が大きくなります

33
00:02:03,980 --> 00:02:08,659
モードや誤り訂正レベルによっても結構変わるんですけれども

34
00:02:08,659 --> 00:02:13,240
例えば誤り訂正レベルMでバイナリーを含める場合

35
00:02:13,240 --> 00:02:15,439
バージョン1だと14バイトだけ

36
00:02:15,439 --> 00:02:18,520
バージョン5だと84バイト

37
00:02:18,520 --> 00:02:21,460
バージョン10では213バイト

38
00:02:21,460 --> 00:02:27,199
最大のバージョン40では2331バイトまで含めることができます

39
00:02:27,199 --> 00:02:31,080
QRコードの読み取り端末によっては

40
00:02:31,080 --> 00:02:35,319
指定のQRコードバージョンしか読み取れないということもあるのです

41
00:02:35,319 --> 00:02:43,099
さて冒頭のCIFilterを使ったQRコード生成に戻ってみると

42
00:02:43,099 --> 00:02:45,060
皆様お気づきでしょうか

43
00:02:45,060 --> 00:02:51,360
これ含めるデータと誤り訂正レベルしか指定できなくね

44
00:02:51,360 --> 00:02:55,560
どうやって特定のQRコードバージョンにしたらいいんだ

45
00:02:55,560 --> 00:03:00,560
どう調べてもバージョンの指定方法なんてないぞ

46
00:03:00,560 --> 00:03:03,939
勝手にいろんなバージョンで生成されるし

47
00:03:03,939 --> 00:03:08,699
勝手にいろんなバージョンで生成されている

48
00:03:08,699 --> 00:03:14,360
これってQRコードに含めるデータのバイト量に応じて

49
00:03:14,360 --> 00:03:17,659
最適化してくれてるってことじゃねって

50
00:03:17,659 --> 00:03:19,240
気づきませんでした

51
00:03:19,240 --> 00:03:20,960
気づきました

52
00:03:20,960 --> 00:03:23,960
つまりこうじゃね

53
00:03:23,960 --> 00:03:27,900
バージョンの最大値に合わせて

54
00:03:27,900 --> 00:03:31,240
頭をゼロで埋めて長さ調整することで

55
00:03:31,240 --> 00:03:33,580
格納するデータは変えずに

56
00:03:33,580 --> 00:03:37,060
狙ったバージョンのQRコード画像を出力できる

57
00:03:37,060 --> 00:03:40,800
こうすることで同じバイナリでも

58
00:03:40,800 --> 00:03:44,199
狙ったバージョンのQRコードを生成することができました

59
00:03:44,199 --> 00:03:45,500
拍手

60
00:03:48,175 --> 00:03:49,600
ありがとうございます

61
00:03:50,175 --> 00:03:55,020
こうなると頑張れば他にもいろんなQRコード作れそうな気がしてきましたよね

62
00:03:56,550 --> 00:03:59,240
皆様フレームQRご存知でしょうか

63
00:03:59,240 --> 00:04:05,280
このフレームQRとはコード内に自由に使えるキャンバス領域を持ったQRコードです

64
00:04:05,280 --> 00:04:11,780
ただこちら個人でちゃんと作ろうとすると結構大変なんですけれども

65
00:04:11,780 --> 00:04:16,439
誤り訂正を利用して自治的に再現することができます

66
00:04:16,439 --> 00:04:22,379
これまでの話で誤り訂正レベルとかさらっと出てきたんですけれども

67
00:04:22,379 --> 00:04:27,120
名前だけ聞いて、誤り訂正するんじゃねって感じだと思うので

68
00:04:27,120 --> 00:04:28,839
ちゃんと説明しようと思います

69
00:04:28,839 --> 00:04:32,939
QRコードの誤り訂正レベルは4種類あって

70
00:04:32,939 --> 00:04:35,040
それぞれの復元率は

71
00:04:35,040 --> 00:04:36,920
Lが7%

72
00:04:36,920 --> 00:04:38,879
Mが15%

73
00:04:38,879 --> 00:04:40,579
Qが25%

74
00:04:40,579 --> 00:04:42,500
Hが30%です

75
00:04:42,500 --> 00:04:46,500
QRコードをビローンと伸ばして

76
00:04:46,500 --> 00:04:50,120
ヘッダーやパディングを除いたところにデータが入っています

77
00:04:50,120 --> 00:04:56,279
そこでデータを構成する最小の単位をコードワードと呼びます

78
00:04:56,279 --> 00:05:00,759
QRコードでは1コードワードが8ビットです

79
00:05:02,175 --> 00:05:04,840
データコードワードが10あったとして

80
00:05:04,839 --> 00:05:08,699
そのうち半分を訂正できるようにしたいと思います

81
00:05:08,699 --> 00:05:16,339
1コードワードを訂正するために誤り訂正コードワード数はその2倍必要となります

82
00:05:17,100 --> 00:05:21,120
なので誤り訂正コードワード数は10になります

83
00:05:21,700 --> 00:05:25,960
よって全コードワード20のうち5個が訂正可能なので

84
00:05:26,525 --> 00:05:34,180
訂正率は5割る20の25%となりこれはレベル9に相当します

85
00:05:35,675 --> 00:05:40,100
またバージョンが大きくなってデータ数が大きくなると

86
00:05:40,100 --> 00:05:43,540
全体を一つのブロックとして誤り訂正をすると

87
00:05:43,540 --> 00:05:46,040
偏りが激しくなってしまったりとか

88
00:05:46,040 --> 00:05:50,480
誤りが訂正されにくくなったりするような現象が起こるので

89
00:05:50,480 --> 00:05:53,420
Read Solomonブロックというものが登場します

90
00:05:53,420 --> 00:06:00,120
データコードワードを複数のブロックにまず分割します

91
00:06:00,939 --> 00:06:06,360
分割したデータコードワードそれぞれに対して誤り訂正を行っていきます

92
00:06:06,360 --> 00:06:14,519
この分割されたデータコードワードと誤り訂正コードワードのセットをリードソロモンブロックと呼びます

93
00:06:15,650 --> 00:06:22,020
この場合訂正率はリードソロモンブロック内のコードワードに対するも のとなります

94
00:06:23,875 --> 00:06:26,700
というわけでバージョン1だとだいたいこんな感じです

95
00:06:27,360 --> 00:06:31,240
ただしこの訂正率は理論上の最低保証値なので

96
00:06:31,240 --> 00:06:34,199
実際にはもうちょい破損しても読み込めますし

97
00:06:34,199 --> 00:06:39,560
破損の仕方や読み込み側が結構頑張ってくれる場合もあるので

98
00:06:39,560 --> 00:06:42,079
読み込み側の性能にもよります

99
00:06:42,079 --> 00:06:47,360
GIGIFRAME QRの場合を作る際には

100
00:06:47,360 --> 00:06:50,379
画像で意図的に破損させる値は

101
00:06:50,379 --> 00:06:53,540
できるだけ理論値に沿っておいた方がいいでしょう

102
00:06:55,000 --> 00:06:57,839
では画像のサイズ感が分かったところで

103
00:06:57,839 --> 00:07:00,560
QRコードを生成して合成しようと思います

104
00:07:00,560 --> 00:07:03,720
まずは普通にQRコードを作ります

105
00:07:03,720 --> 00:07:08,899
合成にはUIグラフィックイメージレンダラーを使います

106
00:07:08,899 --> 00:07:12,800
CIFilterを使って生成したQRコードには

107
00:07:13,625 --> 00:07:16,220
このようなクワイエットゾーンと呼ばれる

108
00:07:16,220 --> 00:07:19,879
周りをぐるっと囲む余白があるんですけれども

109
00:07:19,879 --> 00:07:22,720
QRの定義上では

110
00:07:22,720 --> 00:07:24,740
QRのクワイヤットゾーンには

111
00:07:24,740 --> 00:07:27,259
4セル分の余白を周りにつけるように

112
00:07:27,259 --> 00:07:28,779
定義されているんですけれども

113
00:07:28,779 --> 00:07:32,360
CIFilterで生成されたQRコードには

114
00:07:32,360 --> 00:07:34,860
1セル分の余白しかつけられていないので

115
00:07:34,860 --> 00:07:38,100
左右合わせて2セル分大きくなった状態で

116
00:07:38,100 --> 00:07:40,199
画像サイズを計算するようにします

117
00:07:40,199 --> 00:07:43,560
位置を調整したり合成して

118
00:07:43,560 --> 00:07:46,560
フレームQRできました

119
00:07:46,560 --> 00:07:47,560
拍手

120
00:07:47,560 --> 00:07:51,360
ありがとうございます

121
00:07:51,360 --> 00:07:54,660
特に何も考えずに画像を置く場合

122
00:07:54,660 --> 00:07:58,579
誤り訂正レベルはできるだけ高めに設定しておけば

123
00:07:58,579 --> 00:08:00,800
その分復活する可能性も高いので

124
00:08:00,800 --> 00:08:02,560
そうしておいた方がいいと思います

125
00:08:02,560 --> 00:08:06,180
話はここまでにしようかなと思っていたんですけれど

126
00:08:06,180 --> 00:08:08,899
まだ10分も経っていないぐらいで

127
00:08:08,899 --> 00:08:10,779
思いの墓が早く終わってしまったので

128
00:08:10,779 --> 00:08:14,279
ここからは本当は入れようかなと思っていたんですけど

129
00:08:14,279 --> 00:08:15,860
ちょっと検証が間に合わなかった

130
00:08:15,860 --> 00:08:18,060
今取り組み中の話をします

131
00:08:18,060 --> 00:08:20,439
さっきので

132
00:08:20,439 --> 00:08:23,120
Gizframe QRできんじゃんって思って

133
00:08:23,120 --> 00:08:24,879
めっちゃ調子に乗った私は

134
00:08:24,879 --> 00:08:28,259
もっと特殊なQRコードを作れるんじゃないって思って

135
00:08:28,259 --> 00:08:30,519
さらに調子をこち始めました

136
00:08:30,519 --> 00:08:36,539
じゃあ分割QRコードとかって作れるのかなって思い始めました

137
00:08:36,539 --> 00:08:41,320
QRコードはバージョン40の容量以上のデータを

138
00:08:41,320 --> 00:08:43,200
持たせることはできないんですけれども

139
00:08:43,200 --> 00:08:47,500
分割して上限突破することができるんですね

140
00:08:47,500 --> 00:08:52,860
お薬手帳のQRコードなどで見たことがある人もいるかもしれません

141
00:08:52,860 --> 00:08:57,580
前にQRコードをビロンって伸ばしたときに

142
00:08:57,580 --> 00:08:59,519
ヘッダーがあるってちょっと触れました

143
00:08:59,519 --> 00:09:06,679
普通のQRだとヘッダーは4ビットだけモード支持子が入っているぐらいで

144
00:09:06,679 --> 00:09:08,240
あんまりデータ入ってないんですね

145
00:09:09,550 --> 00:09:11,420
分割QRコードの場合

146
00:09:11,419 --> 00:09:16,580
ヘッダーの冒頭4ビットに3を入れると

147
00:09:16,580 --> 00:09:21,480
それは分割QRコードだということと判断されます

148
00:09:21,480 --> 00:09:29,379
そして次の4ビットに分割されたQRの何番目かというページ番号

149
00:09:29,379 --> 00:09:35,860
その次の4ビットに最大のページ数を格納します

150
00:09:35,860 --> 00:09:38,799
最大のページ数4ビットなので

151
00:09:38,799 --> 00:09:42,419
つまり最大で16分割まで可能ということです

152
00:09:43,525 --> 00:09:46,360
次の4ビットにはパリティの上位

153
00:09:46,360 --> 00:09:47,360
4ビット

154
00:09:47,360 --> 00:09:50,960
その次にはパリティの解4ビットを入れます

155
00:09:50,960 --> 00:09:52,659
このパリティっていうのは

156
00:09:52,659 --> 00:09:56,360
連結するQRコード全てに共通しているもので

157
00:09:56,360 --> 00:10:01,000
全データに対するパリティを算出して使います

158
00:10:01,000 --> 00:10:04,659
なので連結QR読み取り側では

159
00:10:04,659 --> 00:10:08,840
連結用ID的な扱いをされます

160
00:10:08,840 --> 00:10:14,100
他はほとんど普通のQRと同じように作っていきます

161
00:10:15,475 --> 00:10:20,100
それだけ聞くとできなくもないんじゃねって思ってきませんか

162
00:10:20,100 --> 00:10:27,220
でもCIQRCodeGeneratorでヘッダー情報をいじることってできるのかなみたいな

163
00:10:27,220 --> 00:10:27,460
はい

164
00:10:29,275 --> 00:10:29,800
できません

165
00:10:30,825 --> 00:10:32,060
調子に乗りすぎました

166
00:10:32,059 --> 00:10:33,179
悲しいですね

167
00:10:34,675 --> 00:10:36,640
なので手作りしようと思います

168
00:10:36,639 --> 00:10:39,100
ヘッダー情報をいじるだけなので

169
00:10:39,100 --> 00:10:42,039
とりあえず普通のQRコードができるようになれば

170
00:10:42,039 --> 00:10:43,200
できるはずだと思います

171
00:10:43,200 --> 00:10:48,299
Zebra CrossingというJava製のQRコードを生成するための

172
00:10:48,299 --> 00:10:50,559
オープンソースライブラリがあるんですけれども

173
00:10:50,559 --> 00:10:54,179
現在それはメンテナンスモードになっているので

174
00:10:54,179 --> 00:10:58,340
それをさらにC++で書き直されて

175
00:10:58,340 --> 00:11:04,480
いろいろ改善されたZebra Crossing C++というライブラリを参考にします

176
00:11:04,480 --> 00:11:09,279
とはいえC++ 私読めないなと思ったので

177
00:11:09,279 --> 00:11:12,299
現在Swiftへの翻訳を試みているところです

178
00:11:13,083 --> 00:11:16,240
これ全部解説すると今度は時間が収まりきらないので

179
00:11:16,240 --> 00:11:18,220
かなり回数まで説明します

180
00:11:19,875 --> 00:11:22,140
QRコードには4つのモードがあって

181
00:11:22,139 --> 00:11:23,820
モード指示子で指定します

182
00:11:23,820 --> 00:11:27,460
この中でこの8ビットモードを使うと

183
00:11:27,460 --> 00:11:29,460
バイナリーを格納することができます

184
00:11:30,375 --> 00:11:32,420
バイナリーを入れられるということは

185
00:11:32,419 --> 00:11:34,639
日本語以外でもどんな文字列でも

186
00:11:34,639 --> 00:11:36,279
入れることができるということです

187
00:11:37,325 --> 00:11:39,780
今回は一律でバイナリーモードを

188
00:11:39,779 --> 00:11:40,879
使用することにします

189
00:11:40,879 --> 00:11:43,159
これバイナリモードにすると

190
00:11:43,159 --> 00:11:47,759
QRコード生成側でいろいろ頑張って変換したりしなくてよくて

191
00:11:47,759 --> 00:11:50,659
バイナリをそのまま入れることができるので

192
00:11:50,659 --> 00:11:54,419
生成側としてはかなりサボれる便利なモードとなっています

193
00:11:55,800 --> 00:11:58,500
モードが決まったのでヘッダー上として

194
00:11:58,500 --> 00:12:01,559
最初の4ビットにモードCCを入れておきます

195
00:12:02,775 --> 00:12:05,040
そして次にバージョン決めます

196
00:12:05,039 --> 00:12:07,620
特定のバージョンを指定してもいいですし

197
00:12:07,620 --> 00:12:10,440
含めたいデータと誤り訂正レベルから

198
00:12:10,440 --> 00:12:12,899
ちょうどいいバージョンを取得してもいいです

199
00:12:13,350 --> 00:12:14,880
バージョンが決まったら

200
00:12:14,879 --> 00:12:20,039
バージョンの寸法に合わせてQRのマトリックスを作成します

201
00:12:20,039 --> 00:12:22,220
特にコードは書いてないんですけど

202
00:12:22,220 --> 00:12:25,240
私はこれはオプショナルのブールの

203
00:12:25,240 --> 00:12:27,279
二次元配列で表現しています

204
00:12:28,083 --> 00:12:30,820
あとで全部のセルが埋まっているかを

205
00:12:30,820 --> 00:12:32,220
確認しないといけないので

206
00:12:32,220 --> 00:12:34,700
最初は全てNILを入れています

207
00:12:36,200 --> 00:12:38,620
またデータの部分の終わりを

208
00:12:38,620 --> 00:12:41,159
正確に識別できるようにするために

209
00:12:41,159 --> 00:12:43,659
入力するデータのバイト数を

210
00:12:44,750 --> 00:12:47,320
含めたいデータのバイト数を求めて

211
00:12:47,320 --> 00:12:50,659
これをヘッダーに追加します

212
00:12:52,175 --> 00:12:54,980
このバイト数を入れるこのビット数は

213
00:12:54,980 --> 00:12:57,100
バージョンによって決まってます

214
00:12:58,325 --> 00:13:00,360
バージョン1のバイナリーモードでは

215
00:13:00,360 --> 00:13:05,059
ここ8ビット分の長さを入れるエリアがあります

216
00:13:06,725 --> 00:13:12,860
バージョンと誤り訂正レベルからデータ部分に格納できる最大数が取得することができます

217
00:13:13,775 --> 00:13:16,860
バージョン1で誤り訂正レベル9のとき

218
00:13:16,860 --> 00:13:20,799
格納可能数は13バイトです

219
00:13:20,799 --> 00:13:25,240
ただしこれはヘッダー情報も含んだ容量です

220
00:13:25,240 --> 00:13:32,480
ヘッダーが12ビットでデータコードワードが4バイトあって

221
00:13:32,480 --> 00:13:34,740
全部で13バイト入るんで

222
00:13:35,525 --> 00:13:38,340
これで60ビットぐらい余ってますね

223
00:13:38,340 --> 00:13:39,980
これをどうにかしたいです

224
00:13:40,875 --> 00:13:44,840
とりあえずコード後の最後に終端パターンとして

225
00:13:44,840 --> 00:13:48,059
0を4つ4ビット分入れます

226
00:13:48,059 --> 00:13:51,539
これでデータがどこまで入っているか

227
00:13:51,539 --> 00:13:52,960
っていうのを分かりやすくしてます

228
00:13:53,900 --> 00:13:59,440
そしてちょうど1バイトの境界になるように0で調整します

229
00:14:00,700 --> 00:14:04,360
するとちょうど残りは8のバイスのビット分が残るので

230
00:14:04,360 --> 00:14:10,000
パディングパターンとして16進数のECと16進数の11を

231
00:14:10,000 --> 00:14:12,440
交互に入れて埋めていきます

232
00:14:13,750 --> 00:14:16,760
これでデータ部分は全て埋まることができました

233
00:14:18,400 --> 00:14:22,440
データ部分に誤り訂正ブロックをインターリーブします

234
00:14:22,440 --> 00:14:28,279
これはDigiFrame QRで説明した誤り訂正をそのまま入れています

235
00:14:30,375 --> 00:14:33,520
これでメッセージに関する部分は全て揃いました

236
00:14:33,519 --> 00:14:37,039
次はマスクパターンを選択します

237
00:14:37,039 --> 00:14:41,039
マスクパターンとは白と黒のバランスを整えたりとか

238
00:14:41,039 --> 00:14:47,519
意味のある配列と似た配置になってしまいないようにするために使用します

239
00:14:48,575 --> 00:14:50,460
マスクパターンは8種類あって

240
00:14:50,460 --> 00:14:53,200
全てのマスクを試していて

241
00:14:53,200 --> 00:14:57,240
一番良さげなやつを選ぶという風に選んでいきます

242
00:14:58,550 --> 00:15:02,760
試すには一旦マトリックスを構築する必要があるので

243
00:15:02,759 --> 00:15:05,440
ちょっとマスク選択は一旦ステイで

244
00:15:05,440 --> 00:15:07,980
先にマトリックスをビルドしていきます

245
00:15:09,875 --> 00:15:13,660
冒頭で作った空のマトリックスを引っ張ってきて

246
00:15:13,659 --> 00:15:17,399
まずファインドパターンとセパレーターを生み込みます

247
00:15:18,350 --> 00:15:22,680
これは位置とか回転を検出できるやつですね

248
00:15:23,325 --> 00:15:27,020
必要であればアライメントパターンを生み込みます

249
00:15:28,650 --> 00:15:31,140
これバージョン1だとちょっと出ないんですけれども

250
00:15:31,139 --> 00:15:33,860
こんな感じのやつです

251
00:15:34,875 --> 00:15:40,280
バージョンごとにどこにアライメントパターンを出すかっていうのが決められているので

252
00:15:40,279 --> 00:15:43,600
指定の位置に5×5のパターンを埋め込んでいきます

253
00:15:44,150 --> 00:15:49,700
これは歪みによって生じるセルの位置ズレを補正してくれるものです

254
00:15:51,425 --> 00:15:54,340
続いてタイミングパターンを埋め込んでいきます

255
00:15:54,975 --> 00:15:59,080
白と黒のセルを交互に並べていくことで

256
00:15:59,080 --> 00:16:03,340
セルの大きさとセル全体の大きさを伝えて

257
00:16:03,340 --> 00:16:05,019
座標を決定していきます

258
00:16:06,625 --> 00:16:09,120
そしてフォーマット情報を埋め込みます

259
00:16:09,120 --> 00:16:13,279
フォーマット情報とは誤り訂正レベルとマスクパターンのことです

260
00:16:13,279 --> 00:16:16,440
このフォーマット情報については

261
00:16:16,440 --> 00:16:20,200
固定のポリ16芯数の537を使って

262
00:16:20,200 --> 00:16:23,240
BCH符号という誤り訂正符号を

263
00:16:23,240 --> 00:16:25,259
手法を使います

264
00:16:25,259 --> 00:16:27,919
いろいろあるんですけど

265
00:16:27,919 --> 00:16:31,019
これによって10ビットの誤り訂正符号を

266
00:16:31,019 --> 00:16:32,019
得ることができるので

267
00:16:32,019 --> 00:16:33,659
これをくっつけます

268
00:16:34,900 --> 00:16:37,780
これが全部ゼロになっちゃわないように

269
00:16:37,779 --> 00:16:40,799
特定のビットパターンの

270
00:16:40,799 --> 00:16:43,779
16進数の5412というのを

271
00:16:43,779 --> 00:16:46,860
履いたてき論理はを取って

272
00:16:46,860 --> 00:16:48,419
マスクをかけます

273
00:16:49,725 --> 00:16:52,920
これで15ビットのフォーマット情報ができたので

274
00:16:52,919 --> 00:16:54,480
埋め込んでいきます

275
00:16:55,150 --> 00:16:58,420
QRコードの一部が破損したとしても

276
00:16:58,419 --> 00:17:00,980
読み込めるように2箇所に置いていきます

277
00:17:02,850 --> 00:17:06,520
まず1つは左上のファインダーパターンのところと

278
00:17:06,519 --> 00:17:07,319
あともう1個

279
00:17:07,319 --> 00:17:11,640
左下と右上に半々ずつ入れていきます

280
00:17:11,640 --> 00:17:14,359
これでフォーマット情報が格納されました

281
00:17:15,700 --> 00:17:18,060
最後に誤り訂正符号を付けた

282
00:17:18,059 --> 00:17:20,579
データにマスクを適用して

283
00:17:20,579 --> 00:17:23,519
この空いてるところに埋め込んでいきます

284
00:17:23,519 --> 00:17:27,380
これで全てのセルが埋まったマトリックスができたので

285
00:17:27,380 --> 00:17:29,859
マスク選択に戻っていきます

286
00:17:31,225 --> 00:17:36,400
さっきのマトリックスを全部のマスク分作っていって

287
00:17:37,375 --> 00:17:40,720
それぞれのマトリックスに対して評価を行っていきます

288
00:17:41,325 --> 00:17:44,750
これらのこの4つのペナルティを合算して

289
00:17:44,960 --> 00:17:49,319
一番ペナルティが低かったものを最適なマスクとして選定します

290
00:17:50,250 --> 00:17:56,400
これで選定されたマスクで再度マトリックスを構築すれば

291
00:17:56,400 --> 00:18:01,279
QRコードの元になるマトリックスが完成するというところです

292
00:18:01,279 --> 00:18:07,099
このマトリックスブールの二次元配列で私作ってるんですけれども

293
00:18:07,099 --> 00:18:11,319
どうやって画像にしたらいいかなっていうのが今の悩みなので

294
00:18:11,319 --> 00:18:13,480
何かアイデアがあれば

295
00:18:13,480 --> 00:18:15,339
Ask the Speakerで教えてください

296
00:18:16,650 --> 00:18:19,360
最後にぜひ読み取ってほしい

297
00:18:19,359 --> 00:18:20,940
QRコードがこちらです

298
00:18:20,940 --> 00:18:32,619
11月2日に

299
00:18:32,619 --> 00:18:34,799
鎌倉でスイストコミュニティの

300
00:18:34,799 --> 00:18:35,980
イベントをやりますので

301
00:18:35,980 --> 00:18:37,619
ぜひ遊びに来てください

302
00:18:37,620 --> 00:18:40,375
ありがとうございました

303
00:18:46,680 --> 00:18:48,275
ありがとうございました

304
00:18:48,630 --> 00:18:50,340
それではQ& Aに入りたいと思います

305
00:18:50,339 --> 00:18:52,740
コメントやご質問のある方がいらっしゃいましたら

306
00:18:52,740 --> 00:18:53,880
手を挙げてお知らせください

